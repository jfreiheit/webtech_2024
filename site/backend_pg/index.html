
<!doctype html>
<html lang="de" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Lehrmaterial, Übungen, Aufgaben und Hilfen für WebTech">
      
      
        <meta name="author" content="Jörn Freiheit">
      
      
        <link rel="canonical" href="http://freiheit.f4.htw-berlin.de/webtech/backend_pg/">
      
      
        <link rel="prev" href="../backend/">
      
      
        <link rel="next" href="../fe-be-anbindung/">
      
      
      <link rel="icon" href="../img/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.50">
    
    
      
        <title>Backend (PostgreSQL) - WebTech</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.a40c8224.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="grey" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#rest-api" class="md-skip">
          Zum Inhalt
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Kopfzeile">
    <a href=".." title="WebTech" class="md-header__button md-logo" aria-label="WebTech" data-md-component="logo">
      
  <img src="../img/fiw.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            WebTech
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Backend (PostgreSQL)
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Suche" placeholder="Suche" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Suche">
        
        <button type="reset" class="md-search__icon md-icon" title="Zurücksetzen" aria-label="Zurücksetzen" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Suche wird initialisiert
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/jfreiheit/webtech" title="Zum Repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    webtech
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="WebTech" class="md-nav__button md-logo" aria-label="WebTech" data-md-component="logo">
      
  <img src="../img/fiw.jpg" alt="logo">

    </a>
    WebTech
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/jfreiheit/webtech" title="Zum Repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    webtech
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../einfuehrung/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Einführung
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../html/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTML
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../css/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CSS - Selektoren und Eigenschaften
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../rwd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CSS - Responsive Web-Design
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../javascript/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JavaScript - DOM und Arrays
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../objekte/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JavaScript - Objekte und JSON
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../promises/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    JavaScript - Promises und Fetch
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../angular/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Angular - Komponenten
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../templates/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Angular - Templates
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../routing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Angular -  Routing und Services
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../signals/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Angular - Datenfluss und Signals
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../backend/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Backend (MongoDB)
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Backend (PostgreSQL)
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Backend (PostgreSQL)
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rest" class="md-nav__link">
    <span class="md-ellipsis">
      REST
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ein-nodejs-projekt-mit-express" class="md-nav__link">
    <span class="md-ellipsis">
      Ein Node.js-Projekt mit Express
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ein Node.js-Projekt mit Express">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#router" class="md-nav__link">
    <span class="md-ellipsis">
      Router
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starten-des-projektes" class="md-nav__link">
    <span class="md-ellipsis">
      Starten des Projektes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routen" class="md-nav__link">
    <span class="md-ellipsis">
      Routen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dotenv-und-cors" class="md-nav__link">
    <span class="md-ellipsis">
      dotenv und cors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postman" class="md-nav__link">
    <span class="md-ellipsis">
      Postman
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgresql" class="md-nav__link">
    <span class="md-ellipsis">
      PostgreSQL
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crud-funktionen" class="md-nav__link">
    <span class="md-ellipsis">
      CRUD-Funktionen
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CRUD-Funktionen">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#c-create" class="md-nav__link">
    <span class="md-ellipsis">
      C - create
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#r-read-all" class="md-nav__link">
    <span class="md-ellipsis">
      R - read all
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#r-read-one" class="md-nav__link">
    <span class="md-ellipsis">
      R - read one
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#u-update" class="md-nav__link">
    <span class="md-ellipsis">
      U - update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-delete" class="md-nav__link">
    <span class="md-ellipsis">
      D - delete
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../fe-be-anbindung/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Front- & Backend - Anbindung
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../guards/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Front- & Backend - Guards
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../deployment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Front- & Backend - Deployment
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../uebungen/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Übungen
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tools/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Werkzeuge
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Inhaltsverzeichnis">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Inhaltsverzeichnis
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#rest" class="md-nav__link">
    <span class="md-ellipsis">
      REST
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ein-nodejs-projekt-mit-express" class="md-nav__link">
    <span class="md-ellipsis">
      Ein Node.js-Projekt mit Express
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Ein Node.js-Projekt mit Express">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#router" class="md-nav__link">
    <span class="md-ellipsis">
      Router
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starten-des-projektes" class="md-nav__link">
    <span class="md-ellipsis">
      Starten des Projektes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#routen" class="md-nav__link">
    <span class="md-ellipsis">
      Routen
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dotenv-und-cors" class="md-nav__link">
    <span class="md-ellipsis">
      dotenv und cors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#postman" class="md-nav__link">
    <span class="md-ellipsis">
      Postman
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#postgresql" class="md-nav__link">
    <span class="md-ellipsis">
      PostgreSQL
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crud-funktionen" class="md-nav__link">
    <span class="md-ellipsis">
      CRUD-Funktionen
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CRUD-Funktionen">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#c-create" class="md-nav__link">
    <span class="md-ellipsis">
      C - create
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#r-read-all" class="md-nav__link">
    <span class="md-ellipsis">
      R - read all
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#r-read-one" class="md-nav__link">
    <span class="md-ellipsis">
      R - read one
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#u-update" class="md-nav__link">
    <span class="md-ellipsis">
      U - update
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#d-delete" class="md-nav__link">
    <span class="md-ellipsis">
      D - delete
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="rest-api">REST-API<a class="headerlink" href="#rest-api" title="Permanent link">&para;</a></h1>
<p>Ehe wir uns weiter mit dem Frontend beschäftigen, erstellen wir einen Server, der uns die Daten liefert, das sogenannte <em>Backend</em>. Derzeit haben wir unsere Mockup-Daten noch clientseitig von einem Service verwalten lassen. Das wollen wir nun ändern. Die Daten speichern wir in einer Datenbank und stellen sie über eine <em>REST-API</em> bereit. 
Als Datenbank verwenden wir PostgreSQL. </p>
<h2 id="rest">REST<a class="headerlink" href="#rest" title="Permanent link">&para;</a></h2>
<p>Für diese Datenbank stellen wir die Implementierung einer Schnittstelle bereit, so dass wir die wesentlichen Datenbankanfragen darüber ausführen können. Diese wesentlichen Datenbankfragen werden mit <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> abgekürzt, für <strong>C</strong>reate, <strong>R</strong>ead, <strong>U</strong>pdate und <strong>D</strong>elete. Das bedeutet, wir implementieren Funktionalitäten, mit denen wir einen neuen Datensatz in die Datenbank einfügen (<em>create</em>), aus der Datenbank auslesen (<em>read</em>), in der Datenbank aktualisieren (<em>update</em>) und aus der Datenbank löschen (<em>delete</em>) können. </p>
<p>Die Schnittstelle, die wir implementieren, ist eine sogenannte <a href="https://www.redhat.com/de/topics/api/what-is-a-rest-api">REST-API</a>. <em>REST</em> steht für <a href="https://de.wikipedia.org/wiki/Representational_State_Transfer"><em>Representational State Transfer</em></a> und basiert auf einigen wenigen Prinzipien:</p>
<ol>
<li>Alles wird als eine <em>Ressource</em> betrachtet, z.B. <code>book</code>.</li>
<li>Jede Ressource ist durch <em>URIs</em> (<em>Uniform Resource Identifiers</em>) eindeutig identifizierbar, z.B. <code>http://localhost/books</code>.</li>
<li>Es werden die <a href="https://de.wikipedia.org/wiki/Hypertext_Transfer_Protocol#HTTP-Anfragemethoden">Standard-HTTP-Methoden</a> verwendet, also <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>UPDATE</code>.  </li>
<li>Ressourcen können in verschiedenen Formaten vorliegen, z.B. in <a href="https://html.spec.whatwg.org/multipage/">HTML</a>, <a href="https://www.w3.org/TR/xml/">XML</a>, <a href="https://jsonapi.org/format/">JSON</a>, </li>
<li>Die Kommunikation ist <em>zustandslos</em>. Jede einzelne HTTP-Anfrage wird komplett isoliert bearbeitet. Es gibt keinerlei Anfragehistorie. </li>
</ol>
<p>Das bedeutet, wir erstellen ein Backend (einen REST-Server), an den HTTP-Anfragen mit der eindeutig identifizierbaren Ressource gestellt werden. Das Backend erstellt daraus die entsprechende SQL-Query. Das Resultat der Datenbankanfrage wird im <code>JSON</code>- Format bereitsgestellt (kann aber auch <code>HTML</code>, <code>XML</code> oder ein anderes Format sein) bereitsgestellt.</p>
<p><img alt="restapi" src="../files/61_restapi.png" /></p>
<p>Prinzipiell gibt es also ein <em>Mapping</em>  von HTTP-Anfragen auf SQL-Anfragen:</p>
<table>
<thead>
<tr>
<th>CRUD</th>
<th>SQL</th>
<th>MongoDB</th>
<th>HTTP</th>
</tr>
</thead>
<tbody>
<tr>
<td>create</td>
<td>INSERT</td>
<td>insertOne(), insertMany()</td>
<td>POST</td>
</tr>
<tr>
<td>read</td>
<td>SELECT</td>
<td>findOne(), find()</td>
<td>GET</td>
</tr>
<tr>
<td>update</td>
<td>UPDATE</td>
<td>updateOne(), updateMany()</td>
<td>PUT (oder PATCH)</td>
</tr>
<tr>
<td>delete</td>
<td>DELETE</td>
<td>deleteOne(), deleteMany()</td>
<td>DELETE</td>
</tr>
</tbody>
</table>
<p>Zur Unterscheidung zwischen <code>PUT</code> und <code>PATCH</code> siehe z.B. <a href="https://www.geeksforgeeks.org/difference-between-put-and-patch-request/">hier</a> oder <a href="https://stackoverflow.com/questions/21660791/what-is-the-main-difference-between-patch-and-put-request">hier</a>.
Wir wollen uns ein Backend erstellen, über das wir unsere Daten verwalten. Dazu überlegen wir uns zunächst ein paar sogenannte <em>Endpunkte</em> (siehe Prinzipien von REST oben) und die Zugriffsmethoden, mit denen wir auf unsere Daten zugreifen wollen.</p>
<table>
<thead>
<tr>
<th> Methode</th>
<th> URL</th>
<th> Bedeutung</th>
</tr>
</thead>
<tbody>
<tr>
<td> GET</td>
<td> /members</td>
<td> hole alle Datensätze</td>
</tr>
<tr>
<td> GET</td>
<td> /members/11</td>
<td>hole den Datensatz mit der id=11</td>
</tr>
<tr>
<td> POST</td>
<td> /members</td>
<td> füge einen neuen Datensatz hinzu</td>
</tr>
<tr>
<td> PUT</td>
<td> /members/11</td>
<td> ändere den Datensatz mit der id=11</td>
</tr>
<tr>
<td> DELETE</td>
<td> /members/11</td>
<td> lösche den Datensatz mit der id=11</td>
</tr>
<tr>
<td> DELETE</td>
<td> /members</td>
<td> lösche alle Datensätze</td>
</tr>
</tbody>
</table>
<p>Der Wert der <code>id</code> ist natürlich nur ein Beispiel. Es soll für alle <code>id</code>-Werte funktionieren, die in unserem Datensatz enthalten sind. </p>
<h2 id="ein-nodejs-projekt-mit-express">Ein Node.js-Projekt mit Express<a class="headerlink" href="#ein-nodejs-projekt-mit-express" title="Permanent link">&para;</a></h2>
<p>Wir starten damit, uns ein <code>node.js</code>-Projekt zu erstellen. Dazu erstellen wir uns zunächst einen Ordner <code>backend</code>, wechseln in diesen Ordner und führen dann <code>npm init</code> aus:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>mkdir<span class="w"> </span>backend
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nb">cd</span><span class="w"> </span>backend
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>npm<span class="w"> </span>init
</span></code></pre></div>
<p>Sie werden ein paar Sachen gefragt. Im Prinzip können Sie immer <code>Enter</code> drücken:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>This<span class="w"> </span>utility<span class="w"> </span>will<span class="w"> </span>walk<span class="w"> </span>you<span class="w"> </span>through<span class="w"> </span>creating<span class="w"> </span>a<span class="w"> </span>package.json<span class="w"> </span>file.
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>It<span class="w"> </span>only<span class="w"> </span>covers<span class="w"> </span>the<span class="w"> </span>most<span class="w"> </span>common<span class="w"> </span>items,<span class="w"> </span>and<span class="w"> </span>tries<span class="w"> </span>to<span class="w"> </span>guess<span class="w"> </span>sensible<span class="w"> </span>defaults.
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>See<span class="w"> </span><span class="sb">`</span>npm<span class="w"> </span><span class="nb">help</span><span class="w"> </span>init<span class="sb">`</span><span class="w"> </span><span class="k">for</span><span class="w"> </span>definitive<span class="w"> </span>documentation<span class="w"> </span>on<span class="w"> </span>these<span class="w"> </span>fields
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>and<span class="w"> </span>exactly<span class="w"> </span>what<span class="w"> </span>they<span class="w"> </span><span class="k">do</span>.
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>Use<span class="w"> </span><span class="sb">`</span>npm<span class="w"> </span>install<span class="w"> </span>&lt;pkg&gt;<span class="sb">`</span><span class="w"> </span>afterwards<span class="w"> </span>to<span class="w"> </span>install<span class="w"> </span>a<span class="w"> </span>package<span class="w"> </span>and
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>save<span class="w"> </span>it<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>dependency<span class="w"> </span><span class="k">in</span><span class="w"> </span>the<span class="w"> </span>package.json<span class="w"> </span>file.
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>Press<span class="w"> </span>^C<span class="w"> </span>at<span class="w"> </span>any<span class="w"> </span><span class="nb">time</span><span class="w"> </span>to<span class="w"> </span>quit.
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>package<span class="w"> </span>name:<span class="w"> </span><span class="o">(</span>backend<span class="o">)</span><span class="w"> </span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>version:<span class="w"> </span><span class="o">(</span><span class="m">1</span>.0.0<span class="o">)</span><span class="w"> </span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>description:<span class="w"> </span>Backend<span class="w"> </span>REST-API
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>entry<span class="w"> </span>point:<span class="w"> </span><span class="o">(</span>index.js<span class="o">)</span><span class="w"> </span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="nb">test</span><span class="w"> </span>command:<span class="w"> </span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>git<span class="w"> </span>repository:<span class="w"> </span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>keywords:<span class="w"> </span>restapi,<span class="w"> </span>backend
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>author:<span class="w"> </span>J.<span class="w"> </span>Freiheit
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>license:<span class="w"> </span><span class="o">(</span>ISC<span class="o">)</span><span class="w"> </span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>About<span class="w"> </span>to<span class="w"> </span>write<span class="w"> </span>to<span class="w"> </span>/Users/jornfreiheit/WebTech/backend/package.json:
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="o">{</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">  </span><span class="s2">&quot;name&quot;</span>:<span class="w"> </span><span class="s2">&quot;backend&quot;</span>,
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">  </span><span class="s2">&quot;version&quot;</span>:<span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span>,
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="w">  </span><span class="s2">&quot;description&quot;</span>:<span class="w"> </span><span class="s2">&quot;Backend REST-API&quot;</span>,
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w">  </span><span class="s2">&quot;main&quot;</span>:<span class="w"> </span><span class="s2">&quot;index.js&quot;</span>,
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w">  </span><span class="s2">&quot;scripts&quot;</span>:<span class="w"> </span><span class="o">{</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#__codelineno-1-28"></a><span class="w">    </span><span class="s2">&quot;test&quot;</span>:<span class="w"> </span><span class="s2">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#__codelineno-1-29"></a><span class="w">  </span><span class="o">}</span>,
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#__codelineno-1-30"></a><span class="w">  </span><span class="s2">&quot;keywords&quot;</span>:<span class="w"> </span><span class="o">[</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#__codelineno-1-31"></a><span class="w">    </span><span class="s2">&quot;restapi&quot;</span>,
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#__codelineno-1-32"></a><span class="w">    </span><span class="s2">&quot;backend&quot;</span>
</span><span id="__span-1-33"><a id="__codelineno-1-33" name="__codelineno-1-33" href="#__codelineno-1-33"></a><span class="w">  </span><span class="o">]</span>,
</span><span id="__span-1-34"><a id="__codelineno-1-34" name="__codelineno-1-34" href="#__codelineno-1-34"></a><span class="w">  </span><span class="s2">&quot;author&quot;</span>:<span class="w"> </span><span class="s2">&quot;J. Freiheit&quot;</span>,
</span><span id="__span-1-35"><a id="__codelineno-1-35" name="__codelineno-1-35" href="#__codelineno-1-35"></a><span class="w">  </span><span class="s2">&quot;license&quot;</span>:<span class="w"> </span><span class="s2">&quot;ISC&quot;</span>
</span><span id="__span-1-36"><a id="__codelineno-1-36" name="__codelineno-1-36" href="#__codelineno-1-36"></a><span class="o">}</span>
</span><span id="__span-1-37"><a id="__codelineno-1-37" name="__codelineno-1-37" href="#__codelineno-1-37"></a>
</span><span id="__span-1-38"><a id="__codelineno-1-38" name="__codelineno-1-38" href="#__codelineno-1-38"></a>
</span><span id="__span-1-39"><a id="__codelineno-1-39" name="__codelineno-1-39" href="#__codelineno-1-39"></a>Is<span class="w"> </span>this<span class="w"> </span>OK?<span class="w"> </span><span class="o">(</span>yes<span class="o">)</span><span class="w"> </span>
</span></code></pre></div>
<p>Die <code>package.json</code> wurde erstellt. Nun benötigen wir noch das Modul <a href="https://expressjs.com/de/">Express</a>. Express bietet uns eine unkomplizierte <em>Middleware</em> für die Weiterverwaltung von <code>http</code>-Anfragen an die Datenbank und zurück. </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>npm<span class="w"> </span>install<span class="w"> </span>express<span class="w"> </span>--save
</span></code></pre></div>
<p>Sie erhalten eine Meldung in der Form:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>%<span class="w"> </span>npm<span class="w"> </span>install<span class="w"> </span>express<span class="w"> </span>--save
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>added<span class="w"> </span><span class="m">50</span><span class="w"> </span>packages,<span class="w"> </span>and<span class="w"> </span>audited<span class="w"> </span><span class="m">51</span><span class="w"> </span>packages<span class="w"> </span><span class="k">in</span><span class="w"> </span>844ms
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>found<span class="w"> </span><span class="m">0</span><span class="w"> </span>vulnerabilities
</span></code></pre></div>
<p>In der <code>package.json</code> wurde die entsprechende Abhängigkeit eingetragen: </p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">package.json</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-json highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;backend&quot;</span><span class="p">,</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Backend REST-API&quot;</span><span class="p">,</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">  </span><span class="nt">&quot;main&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;index.js&quot;</span><span class="p">,</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">  </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="w">    </span><span class="nt">&quot;test&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">  </span><span class="nt">&quot;keywords&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="w">    </span><span class="s2">&quot;restapi&quot;</span><span class="p">,</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="w">    </span><span class="s2">&quot;backend&quot;</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="w">  </span><span class="nt">&quot;author&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;J. Freiheit&quot;</span><span class="p">,</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="w">  </span><span class="nt">&quot;license&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ISC&quot;</span><span class="p">,</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="hll"><span class="w">  </span><span class="nt">&quot;dependencies&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span></span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="hll"><span class="w">    </span><span class="nt">&quot;express&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^4.18.2&quot;</span>
</span></span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="hll"><span class="w">  </span><span class="p">}</span>
</span></span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Öffnen Sie nun das <code>backend</code>-Projekt in Ihrer IDE und erstellen Sie sich dort eine Datei <code>server.js</code> mit folgendem Inhalt:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">server.js</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-javascript highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-5-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-5-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-5-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-5-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-5-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-5-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-5-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-5-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-5-10">10</a></span>
<span class="normal"><a href="#__codelineno-5-11">11</a></span>
<span class="normal"><a href="#__codelineno-5-12">12</a></span>
<span class="normal"><a href="#__codelineno-5-13">13</a></span>
<span class="normal"><a href="#__codelineno-5-14">14</a></span>
<span class="normal"><a href="#__codelineno-5-15">15</a></span>
<span class="normal"><a href="#__codelineno-5-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">routes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes&#39;</span><span class="p">);</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">();</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="kd">const</span><span class="w"> </span><span class="nx">PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3000</span><span class="p">;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">routes</span><span class="p">);</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9"></a>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Server started and listening on port </span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb"> ... `</span><span class="p">);</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="p">});</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Das bedeutet, wir importieren <code>express</code> (Zeile <code>1</code>), erzeugen uns davon ein Objekt und speichern dieses in der Variablen <code>app</code> (Zeile <code>4</code>). Wir legen in einer Konstanten <code>PORT</code> die Portnummer <code>3000</code> fest (Zeile <code>5</code> - die Portnummer können Sie wählen). Das <code>backend</code> ist somit unter <code>http://localhost:3000</code> verfügbar. Das eigentliche Starten des Webservers erfolgt in den Zeilen <code>10-16</code> durch Aufruf der <code>listen()</code>-Funktion von <code>express</code>. Die Syntax der <code>listen()</code>-Funktion ist generell wie folgt:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>app.listen<span class="o">([</span>port<span class="o">[</span>,<span class="w"> </span>host<span class="o">[</span>,<span class="w"> </span>backlog<span class="o">]]][</span>,<span class="w"> </span>callback<span class="o">])</span>
</span></code></pre></div>
<p>Wir übergeben als ersten Parameter die <code>PORT</code>-Nummer (<code>3000</code>) und als zweiten Parameter eine (anonyme) Funktion als sogenannten <em>callback</em>. <em>Callbacks</em> sind <a href="../promises/#callbacks">hier</a> näher erläutert. Die anonyme Funktion wird durch die <code>listen()</code>-Funktion aufgerufen. Sollte ein Fehler aufgetreten sein (z.B. wenn der Port bereits belegt ist), wird der anonymen Funktion ein <code>error</code>-Objekt übergeben. Ist das der Fall, wird der Fehler auf der Konsole ausgegeben. Wird der anonymen Funktion kein Objekt übergeben, wurde der Webserver korrekt gestartet und die entsprechende Meldung erscheint auf der Konsole. </p>
<p>Die Definitionsfunktion in <em>Arrow-Notation</em> </p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Server started and listening on port </span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb"> ... `</span><span class="p">);</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="p">}</span>
</span></code></pre></div>
<p>ist äquivalent zu </p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Server started and listening on port </span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb"> ... `</span><span class="p">);</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="p">}</span>
</span></code></pre></div>
<p><code>error</code> ist der Name des hier gewählten Parameters. Beachten Sie auch die verwendete Syntax <code>${PORT}</code> im sogenannte <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals">template literal</a>. Beachten Sie, dass <em>template literals</em> nicht in einfachen (<code>'</code>) oder doppelten (<code>"</code>) Anführungsstrichen stehen, sondern in <code>&#96;</code> (<em>backticks</em>). </p>
<h3 id="router">Router<a class="headerlink" href="#router" title="Permanent link">&para;</a></h3>
<p>Noch lässt sich unser Programm aber nicht ausführen. Wir benötigen im Projektordner noch eine Datei <code>routes.js</code>. Diese wird nämlich in der <code>server.js</code> bereits in Zeile <code>2</code> eingebunden und in Zeile <code>8</code> verwendet. </p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">routes.js</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-javascript highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="c1">// eine GET-Anfrage</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Hello FIW!&quot;</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="p">});</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9"></a>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">router</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Beim <code>Router</code> handelt es sich um eine <em>Middleware</em> (siehe <a href="https://expressjs.com/de/guide/using-middleware.html">hier</a>), die die Routen verwaltet und <code>request</code>-Objekte an die entsprechende Routen weiterleitet und <code>response</code>-Objekte empfängt. In unserer <code>routes.js</code> haben wir zunächst eine <code>GET</code>-Anfrage implementiert (Zeile <code>5</code>). Das <code>request</code>-Objekt heißt hier <code>req</code>. Das verwenden wir aber gar nicht. Das <code>respones</code>-Objekt heißt hier <code>res</code> und wird durch die Anfrage erzeugt. Wir senden in der <code>response</code> ein JavaScript-Objekt zurück, das einen Schlüssel <code>message</code> enthält. </p>
<p>In der <code>server.js</code> haben wir mit <code>app.use(express.json())</code> (Zeile <code>7</code>) angegeben, dass alle JavaScript-Objekte in der <code>response</code> nach JSON umgewandelt werden sollen. Wenn nun die URL <code>localhost:3000</code> aufgerufen wird, dann wird ein <code>request</code> ausgelöst, den wir hier mit <code>Hello FIW!</code> als <code>response</code> beantworten (Zeilen <code>5-8</code>). </p>
<p>Wichtig ist, dass wir <code>router</code> mit <code>module.exports</code> exportieren, damit es von anderen Modulen importiert und genutzt werden kann. Siehe dazu z.B. <a href="https://www.sitepoint.com/understanding-module-exports-exports-node-js/">hier</a>. </p>
<p>Noch "läuft" unser Backend aber noch nicht. Wir müssen es erst starten. </p>
<h3 id="starten-des-projektes">Starten des Projektes<a class="headerlink" href="#starten-des-projektes" title="Permanent link">&para;</a></h3>
<p>Das Projekt lässt sich nun starten. Wir geben dazu im Terminal im <code>backend</code>-Ordner</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>node<span class="w"> </span>server.js
</span></code></pre></div>
<p>ein. Im Terminal erscheint </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>Server<span class="w"> </span>started<span class="w"> </span>and<span class="w"> </span>listening<span class="w"> </span>on<span class="w"> </span>port<span class="w"> </span><span class="m">3000</span><span class="w"> </span>
</span></code></pre></div>
<p>und wenn Sie im Browser die URL <code>http://localhost:3000/</code> eingeben, wird dort</p>
<p><img alt="backend" src="../files/91_backend.png" /></p>
<p>angezeigt. Sie können auch Postman öffnen und <code>http://localhost:3000</code> eintragen (<code>GET</code>-Methode):</p>
<p><img alt="backend" src="../files/92_postman.png" /></p>
<p>Wann immer wir jetzt jedoch etwas an der Implementierung ändern, müssten wir im Terminal zunächst den Webserver mit </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>Strg-C<span class="w">      </span>//<span class="w"> </span>bzw.<span class="w"> </span>Control-C
</span></code></pre></div>
<p>stoppen, um ihn dann wieder mit <code>node server.js</code> zu starten. Um das zu umgehen, gibt es für <code>node</code> nun die Option <code>--watch</code> (siehe <a href="https://nodejs.org/docs/latest/api/cli.html#--watch">hier</a>). Wenn wir unser Projekt also mit </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a>node<span class="w"> </span>--watch<span class="w"> </span>server.js
</span></code></pre></div>
<p>starten, dann compiliert es stets automatisch neu sobald wir etwas am Code ändern. </p>
<h3 id="routen">Routen<a class="headerlink" href="#routen" title="Permanent link">&para;</a></h3>
<p>Hier nur zum Verständnis. Angenommen, wir ändern bspw. in der <code>server.js</code> die Zeile <code>8</code> zu </p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/api&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">routes</span><span class="p">);</span>
</span></code></pre></div>
<p>, dann würden alle Routen, die wir in <code>routes.js</code> definieren, unter <code>localhost:3000/api</code> verfügbar sein. Wenn wir dann also z.B. in der <code>routes.js</code> die Zeile <code>5</code> zu </p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/fiw&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span></code></pre></div>
<p>ändern, dann ist der GET-Endpunkt <code>localhost:3000/api/fiw</code>. </p>
<h3 id="dotenv-und-cors"><code>dotenv</code> und <code>cors</code><a class="headerlink" href="#dotenv-und-cors" title="Permanent link">&para;</a></h3>
<p>Wir installieren zwei weitere Pakete: <a href="https://www.npmjs.com/package/dotenv"><code>dotenv</code></a> und <a href="https://www.npmjs.com/package/cors"><code>cors</code></a></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a>npm<span class="w"> </span>install<span class="w"> </span>dotenv
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>npm<span class="w"> </span>install<span class="w"> </span>cors<span class="w"> </span>
</span></code></pre></div>
<p>Das <code>dotenv</code>-Paket wird verwendet, um Zugangs- und Konfigurationsdaten in eine <code>.env</code>-Datei auszulagern und diese Daten dann mittels <code>process.env</code> in den Quellcode einzubinden. Dies führt zu einer vollständigen Entkopplung von Zugangs- und Konfigurationsdaten vom Code.</p>
<p>In der <code>.env</code>-Datei werden Schlüssel-Werte-Paare abgelegt, z.B. </p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:1"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Beispiel aus .env-Datei</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nv">PGUSER</span><span class="o">=</span>postgres
</span></code></pre></div>
</div>
</div>
</div>
<p>In einem Skript, in dem nun die in <code>.env</code> hinterlegten Werte verwendet werden sollen, muss <code>dotenv</code> importiert und dafür die <code>config()</code>-Funktion aufgerufen werden:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:1"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">Einbinden von dotenv pro Skript</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-js highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dotenv&#39;</span><span class="p">).</span><span class="nx">config</span><span class="p">();</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>Auf den Wert kann dann mittels <code>process.env</code> und den Schlüssel zugegriffen werden:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:1"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">Verwenden des hinterlegten Wertes</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-js highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PGUSER</span><span class="p">,</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>Beachten Sie, dass die Schlüssel-Werte-Paare nicht zwingend in einer <code>.env</code>-Datei definiert werden müssen. Es können z.B. auch die Umgebungsvariablen verwendet werden, die Sie z.B. in Ihrer <code>.zshrc</code>, <code>.bashrc</code>, <code>.profile</code> usw. definiert haben. </p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Beachten Sie außerdem, <code>.env</code> unbedingt in die <code>.gitignore</code> hinzuzufügen! Sie wollen (und sollen!) diese Informationen keinesfalls in ein Remote-Repository laden!</p>
</div>
<p>Das <code>cors</code>-Paket ermöglicht <em>cross origin resouce sharing (CORS)</em>. <em>CORS</em> ermöglicht, die <em>same origin policy (SOP)</em> zu umgehen. Die <em>SOP</em> ist ein Sciherheitsmechanismus, der dafür sorgt, dass potenziell schädliche Webseiten und Skripte isoliert werden. Nach der <em>SOP</em> darf kein Skript aus einer Webseite einer bestimmten Herkunft (<em>origin</em>) auf eine Webseite anderer Herkunft zugreifen. Das heißt, es soll nicht möglich sein, dass ein fremdes Skript eine Webmailerseite oder ein Intranet, in das ein Nutzerin eingelogged ist, ausliest. Gegenseitige Datenzugriffe soll nur durch Webseiten und Skripte gleicher Herkunft möglich sein. Zur Unterscheidung der Herkunft wird das Protokoll, der Host und der Port miteinander verglichen. Z.B. Vergleich mit <code>http://www.example.de/index.html</code>:</p>
<table>
<thead>
<tr>
<th> URI</th>
<th>Herkunft</th>
<th> Begründung</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>https://www.example.de/index.html</code></td>
<td> unterschiedlich</td>
<td> unterschiedliches Protokoll</td>
</tr>
<tr>
<td><code>http://www.example.de/index.html:3000</code></td>
<td> unterschiedlich</td>
<td> unterschiedlicher Port</td>
</tr>
<tr>
<td><code>http://webmail.example.de/index.html</code></td>
<td> unterschiedlich</td>
<td> unterschiedlicher Host</td>
</tr>
<tr>
<td><code>http://www.example.de/seite1.html</code></td>
<td>gleich</td>
<td> gleiches Protokoll, Host und Port</td>
</tr>
</tbody>
</table>
<p><em>CORS</em> ermöglicht den Zugriff von verschiedenen Herkünften, wenn diese explizit als Ausnahmen der <em>SOP</em> definiert werden. Dies ist über den Header von HTTP-Anfragen möglich. Nähere Einzelheiten dazu z.B. <a href="https://developer.mozilla.org/de/docs/Web/HTTP/CORS">hier</a>. </p>
<p>Um das <code>cors</code>-Paket zu verwenden, wird es (nach der Installation mit <code>npm i cors</code>) in das Hauptskript (meistens <code>server.js</code>) eingebunden:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:1"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">Einbinden von cors in server.js</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-js highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">cors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cors&#39;</span><span class="p">);</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>und wird dann als <em>Middleware</em> zwischen <strong>alle</strong> Routen-Aufrufe erstellt:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:1"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">Allen Anfragen cors erlauben</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-js highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cors</span><span class="p">());</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>Der Zugriff könnte auch eingeschränkt werden. Wenn z.B. nur bei allen <code>/api</code>-Routen *cross-origin resource sharing*möglich sein soll, kann wie folgt definiert werden:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:1"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">nur /api-Routen cors erlauben</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-js highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/api&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">cors</span><span class="p">(),</span><span class="w"> </span><span class="nx">routes</span><span class="p">);</span>
</span></code></pre></div>
</div>
</div>
</div>
<p>Nach der Installation von <code>dotenv</code> und <code>cors</code> sollte unsere <code>server.js</code> wie folgt aussehen:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:1"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">server.js</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-js highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-23-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-23-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-23-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-23-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-23-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-23-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-23-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-23-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-23-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-23-10">10</a></span>
<span class="normal"><a href="#__codelineno-23-11">11</a></span>
<span class="normal"><a href="#__codelineno-23-12">12</a></span>
<span class="normal"><a href="#__codelineno-23-13">13</a></span>
<span class="normal"><a href="#__codelineno-23-14">14</a></span>
<span class="normal"><a href="#__codelineno-23-15">15</a></span>
<span class="normal"><a href="#__codelineno-23-16">16</a></span>
<span class="normal"><a href="#__codelineno-23-17">17</a></span>
<span class="normal"><a href="#__codelineno-23-18">18</a></span>
<span class="normal"><a href="#__codelineno-23-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">cors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cors&#39;</span><span class="p">);</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dotenv&#39;</span><span class="p">).</span><span class="nx">config</span><span class="p">();</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">routes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes&#39;</span><span class="p">);</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5"></a>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">();</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="kd">const</span><span class="w"> </span><span class="nx">PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3000</span><span class="p">;</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8"></a>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cors</span><span class="p">());</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">routes</span><span class="p">);</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12"></a>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Server started and listening on port </span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb"> ...`</span><span class="p">);</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="p">})</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<h3 id="postman">Postman<a class="headerlink" href="#postman" title="Permanent link">&para;</a></h3>
<p>Gegenwärtig enthält unsere <code>routes.js</code> genau einen Endpunkt für eine <code>GET</code>-Anfrage:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:1"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="__tabbed_11_1">routes.js</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-javascript highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-24-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-24-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-24-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-24-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-24-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-24-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-24-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-24-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-24-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-24-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="c1">// eine GET-Anfrage</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6"></a>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="w">    </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Hello FIW!&quot;</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="p">});</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9"></a>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">router</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Das werden wir gleich ändern und es werden andere Anfragemethoden verwendet, z.B. <code>POST</code>, <code>PUT</code> und <code>DELETE</code>. Wenn wir eine URL in einen Browser eingeben, wird stets ein <code>GET</code> auf die angegebene Resource ausgeführt. Das heißt, mit dem Browser können wir nur <code>GET</code>-Anfragen testen:</p>
<p><img alt="backend" src="../files/297_backend.png" /></p>
<p>Um auch andere Anfragemethoden zu testen, benötigen wir ein Programm, das auch andere Anfragemethoden verarbeiten kann. Es gibt viele solche Programme, z.B. <a href="https://www.soapui.org/">SoapUI</a>, <a href="https://paw.cloud/">RapidAPI</a>, <a href="https://insomnia.rest/">Insomnia</a> usw. Wir verwenden hier <a href="https://www.postman.com/downloads/">Postman</a>:</p>
<p><img alt="backend" src="../files/298_backend.png" /></p>
<p>Wir werden gleich die Anwendung von Postman für die verschiedenen Anfragemethoden sehen. </p>
<h2 id="postgresql">PostgreSQL<a class="headerlink" href="#postgresql" title="Permanent link">&para;</a></h2>
<p>PostgreSQL können Sie sich selbst lokal <a href="https://www.postgresql.org/download/">installieren</a> oder Sie nutzen den PostgreSQL-Server auf <code>ocean.f4.htw-berlin.de</code>. Das folgende Beispiel zeigt die Verwendung des Servers <code>ocean.f4.htw-berlin.de</code>. </p>
<p>Jetzt erstellen wir die Datenbank und binden sie an.</p>
<ol>
<li>
<p><code>ocean.f4.htw-berlin.de</code> aufrufen, als Name der Datenbank <code>members</code> eingeben und auf die <code>PostgreSQL</code>-Karte klicken</p>
<p><img alt="backend" src="../files/223_backend-pg.png" /></p>
</li>
<li>
<p>Modul <code>pg</code> installieren (siehe <a href="https://www.npmjs.com/package/pg">hier</a>) sowie <code>.env</code> und <code>db.js</code> im Projektordner <code>backend</code> erstellen:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>npm<span class="w"> </span>i<span class="w"> </span>pg<span class="w"> </span>
</span></code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="12:2"><input checked="checked" id="__tabbed_12_1" name="__tabbed_12" type="radio" /><input id="__tabbed_12_2" name="__tabbed_12" type="radio" /><div class="tabbed-labels"><label for="__tabbed_12_1">.env</label><label for="__tabbed_12_2">db.js</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-js highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-26-1">1</a></span>
<span class="normal"><a href="#__codelineno-26-2">2</a></span>
<span class="normal"><a href="#__codelineno-26-3">3</a></span>
<span class="normal"><a href="#__codelineno-26-4">4</a></span>
<span class="normal"><a href="#__codelineno-26-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="nx">PGUSER</span><span class="o">=</span><span class="nx">ihr_account_name</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="nx">PGHOST</span><span class="o">=</span><span class="nx">psql</span><span class="p">.</span><span class="nx">f4</span><span class="p">.</span><span class="nx">htw</span><span class="o">-</span><span class="nx">berlin</span><span class="p">.</span><span class="nx">de</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="nx">PGPASSWORD</span><span class="o">=</span><span class="nx">ihr_passwort</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="nx">PGDATABASE</span><span class="o">=</span><span class="nx">members</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="nx">PGPORT</span><span class="o">=</span><span class="mf">5432</span>
</span></code></pre></div></td></tr></table></div>
</div>
<div class="tabbed-block">
<div class="language-js highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-27-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-27-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-27-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-27-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-27-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-27-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-27-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-27-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-27-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-27-10">10</a></span>
<span class="normal"><a href="#__codelineno-27-11">11</a></span>
<span class="normal"><a href="#__codelineno-27-12">12</a></span>
<span class="normal"><a href="#__codelineno-27-13">13</a></span>
<span class="normal"><a href="#__codelineno-27-14">14</a></span>
<span class="normal"><a href="#__codelineno-27-15">15</a></span>
<span class="normal"><a href="#__codelineno-27-16">16</a></span>
<span class="normal"><a href="#__codelineno-27-17">17</a></span>
<span class="normal"><a href="#__codelineno-27-18">18</a></span>
<span class="normal"><a href="#__codelineno-27-19">19</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">pg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pg&#39;</span><span class="p">);</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2"></a>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">pg</span><span class="p">.</span><span class="nx">Client</span><span class="p">({</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">    </span><span class="nx">user</span><span class="o">:</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PGUSER</span><span class="p">,</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="w">    </span><span class="nx">host</span><span class="o">:</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PGHOST</span><span class="p">,</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="w">    </span><span class="nx">database</span><span class="o">:</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PGDATABASE</span><span class="p">,</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="w">    </span><span class="nx">password</span><span class="o">:</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PGPASSWORD</span><span class="p">,</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="w">    </span><span class="nx">port</span><span class="o">:</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PGPORT</span><span class="p">,</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="p">});</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10"></a>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11"></a><span class="nx">client</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">err</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Connection to DB ...&#39;</span><span class="p">);</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17"></a><span class="p">});</span>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18"></a>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19"></a><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">client</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
</li>
<li>
<p>Wir erstellen uns ein Extra-Skript, um die die Datenbank mit Einträgen per Skript zu befüllen: Dazu erstellen wir eine Datei <code>initdb.js</code>, in der für die Datenbank eine Tabelle <code>members</code> erstellt und diese mit Einträgen befüllt wird. Da es recht aufwendig ist, sehr viele Einträge in die Datenbank mit dem <code>pg</code>-Modul zu schreiben, installieren wir noch ein zusätzliches Paket <code>pg-format</code>, mit dessen Hilfe es möglich ist, die vielen Werte als ein verschachteltes Array anzugeben. Informationen zu <code>pg-format</code> finden Sie <a href="https://www.npmjs.com/package/pg-format">hier</a>.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>npm<span class="w"> </span>i<span class="w"> </span>pg-format<span class="w"> </span>
</span></code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="13:1"><input checked="checked" id="__tabbed_13_1" name="__tabbed_13" type="radio" /><div class="tabbed-labels"><label for="__tabbed_13_1">initdb.js</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-js highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-29-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-29-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-29-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-29-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-29-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-29-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-29-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-29-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-29-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-29-10">10</a></span>
<span class="normal"><a href="#__codelineno-29-11">11</a></span>
<span class="normal"><a href="#__codelineno-29-12">12</a></span>
<span class="normal"><a href="#__codelineno-29-13">13</a></span>
<span class="normal"><a href="#__codelineno-29-14">14</a></span>
<span class="normal"><a href="#__codelineno-29-15">15</a></span>
<span class="normal"><a href="#__codelineno-29-16">16</a></span>
<span class="normal"><a href="#__codelineno-29-17">17</a></span>
<span class="normal"><a href="#__codelineno-29-18">18</a></span>
<span class="normal"><a href="#__codelineno-29-19">19</a></span>
<span class="normal"><a href="#__codelineno-29-20">20</a></span>
<span class="normal"><a href="#__codelineno-29-21">21</a></span>
<span class="normal"><a href="#__codelineno-29-22">22</a></span>
<span class="normal"><a href="#__codelineno-29-23">23</a></span>
<span class="normal"><a href="#__codelineno-29-24">24</a></span>
<span class="normal"><a href="#__codelineno-29-25">25</a></span>
<span class="normal"><a href="#__codelineno-29-26">26</a></span>
<span class="normal"><a href="#__codelineno-29-27">27</a></span>
<span class="normal"><a href="#__codelineno-29-28">28</a></span>
<span class="normal"><a href="#__codelineno-29-29">29</a></span>
<span class="normal"><a href="#__codelineno-29-30">30</a></span>
<span class="normal"><a href="#__codelineno-29-31">31</a></span>
<span class="normal"><a href="#__codelineno-29-32">32</a></span>
<span class="normal"><a href="#__codelineno-29-33">33</a></span>
<span class="normal"><a href="#__codelineno-29-34">34</a></span>
<span class="normal"><a href="#__codelineno-29-35">35</a></span>
<span class="normal"><a href="#__codelineno-29-36">36</a></span>
<span class="normal"><a href="#__codelineno-29-37">37</a></span>
<span class="normal"><a href="#__codelineno-29-38">38</a></span>
<span class="normal"><a href="#__codelineno-29-39">39</a></span>
<span class="normal"><a href="#__codelineno-29-40">40</a></span>
<span class="normal"><a href="#__codelineno-29-41">41</a></span>
<span class="normal"><a href="#__codelineno-29-42">42</a></span>
<span class="normal"><a href="#__codelineno-29-43">43</a></span>
<span class="normal"><a href="#__codelineno-29-44">44</a></span>
<span class="normal"><a href="#__codelineno-29-45">45</a></span>
<span class="normal"><a href="#__codelineno-29-46">46</a></span>
<span class="normal"><a href="#__codelineno-29-47">47</a></span>
<span class="normal"><a href="#__codelineno-29-48">48</a></span>
<span class="normal"><a href="#__codelineno-29-49">49</a></span>
<span class="normal"><a href="#__codelineno-29-50">50</a></span>
<span class="normal"><a href="#__codelineno-29-51">51</a></span>
<span class="normal"><a href="#__codelineno-29-52">52</a></span>
<span class="normal"><a href="#__codelineno-29-53">53</a></span>
<span class="normal"><a href="#__codelineno-29-54">54</a></span>
<span class="normal"><a href="#__codelineno-29-55">55</a></span>
<span class="normal"><a href="#__codelineno-29-56">56</a></span>
<span class="normal"><a href="#__codelineno-29-57">57</a></span>
<span class="normal"><a href="#__codelineno-29-58">58</a></span>
<span class="normal"><a href="#__codelineno-29-59">59</a></span>
<span class="normal"><a href="#__codelineno-29-60">60</a></span>
<span class="normal"><a href="#__codelineno-29-61">61</a></span>
<span class="normal"><a href="#__codelineno-29-62">62</a></span>
<span class="normal"><a href="#__codelineno-29-63">63</a></span>
<span class="normal"><a href="#__codelineno-29-64">64</a></span>
<span class="normal"><a href="#__codelineno-29-65">65</a></span>
<span class="normal"><a href="#__codelineno-29-66">66</a></span>
<span class="normal"><a href="#__codelineno-29-67">67</a></span>
<span class="normal"><a href="#__codelineno-29-68">68</a></span>
<span class="normal"><a href="#__codelineno-29-69">69</a></span>
<span class="normal"><a href="#__codelineno-29-70">70</a></span>
<span class="normal"><a href="#__codelineno-29-71">71</a></span>
<span class="normal"><a href="#__codelineno-29-72">72</a></span>
<span class="normal"><a href="#__codelineno-29-73">73</a></span>
<span class="normal"><a href="#__codelineno-29-74">74</a></span>
<span class="normal"><a href="#__codelineno-29-75">75</a></span>
<span class="normal"><a href="#__codelineno-29-76">76</a></span>
<span class="normal"><a href="#__codelineno-29-77">77</a></span>
<span class="normal"><a href="#__codelineno-29-78">78</a></span>
<span class="normal"><a href="#__codelineno-29-79">79</a></span>
<span class="normal"><a href="#__codelineno-29-80">80</a></span>
<span class="normal"><a href="#__codelineno-29-81">81</a></span>
<span class="normal"><a href="#__codelineno-29-82">82</a></span>
<span class="normal"><a href="#__codelineno-29-83">83</a></span>
<span class="normal"><a href="#__codelineno-29-84">84</a></span>
<span class="normal"><a href="#__codelineno-29-85">85</a></span>
<span class="normal"><a href="#__codelineno-29-86">86</a></span>
<span class="normal"><a href="#__codelineno-29-87">87</a></span>
<span class="normal"><a href="#__codelineno-29-88">88</a></span>
<span class="normal"><a href="#__codelineno-29-89">89</a></span>
<span class="normal"><a href="#__codelineno-29-90">90</a></span>
<span class="normal"><a href="#__codelineno-29-91">91</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./db&#39;</span><span class="p">);</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">initdb</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;pg-format&#39;</span><span class="p">);</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5"></a>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6"></a>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="nx">initdb</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8"></a>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="w">    </span><span class="c1">// Anlegen der Tabelle members</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="sb">            DROP TABLE IF EXISTS members;</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12"></a><span class="sb">            CREATE TABLE members(id serial PRIMARY KEY, firstname VARCHAR(50), lastname VARCHAR(50), email VARCHAR(50));</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13"></a><span class="sb">            `</span><span class="p">;</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14"></a>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16"></a><span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Table created successfully ...&quot;</span><span class="p">)</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21"></a>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22"></a><span class="w">    </span><span class="c1">// Befüllen der Tabelle members mit 50 Einträgen</span>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Catherine&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Williams&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;cwilliamsl@360.cn&quot;</span><span class="p">],</span>
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Adam&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Anderson&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;aanderson8@google.fr&quot;</span><span class="p">],</span>
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Susan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Andrews&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;sandrewsn@google.co.jp&quot;</span><span class="p">],</span>
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Catherine&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Andrews&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;candrewsp@noaa.gov&quot;</span><span class="p">],</span>
</span><span id="__span-29-28"><a id="__codelineno-29-28" name="__codelineno-29-28"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Alan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Bradley&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;abradley1c@globo.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-29"><a id="__codelineno-29-29" name="__codelineno-29-29"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Anne&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Brooks&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;abrooks16@bravesites.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-30"><a id="__codelineno-29-30" name="__codelineno-29-30"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Russell&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Brown&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rbrownq@nifty.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-31"><a id="__codelineno-29-31" name="__codelineno-29-31"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Ryan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Burton&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rburton18@foxnews.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-32"><a id="__codelineno-29-32" name="__codelineno-29-32"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Roy&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Campbell&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rcampbell1@geocities.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-33"><a id="__codelineno-29-33" name="__codelineno-29-33"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Russell&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Campbell&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rcampbell17@eventbrite.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-34"><a id="__codelineno-29-34" name="__codelineno-29-34"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Bonnie&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Coleman&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;bcoleman11@fc2.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-35"><a id="__codelineno-29-35" name="__codelineno-29-35"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Ernest&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Coleman&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ecoleman15@businessweek.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-36"><a id="__codelineno-29-36" name="__codelineno-29-36"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Richard&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Cruz&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rcruz7@unc.edu&quot;</span><span class="p">],</span>
</span><span id="__span-29-37"><a id="__codelineno-29-37" name="__codelineno-29-37"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Sean&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Cruz&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;scruz10@answers.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-38"><a id="__codelineno-29-38" name="__codelineno-29-38"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Rebecca&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Cunningham&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rcunninghamd@mac.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-39"><a id="__codelineno-29-39" name="__codelineno-29-39"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Margaret&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Evans&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mevansh@pcworld.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-40"><a id="__codelineno-29-40" name="__codelineno-29-40"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Jeffrey&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Ford&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;jford14@cnet.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-41"><a id="__codelineno-29-41" name="__codelineno-29-41"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Andrea&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Gardner&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;agardnerv@woothemes.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-42"><a id="__codelineno-29-42" name="__codelineno-29-42"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Deborah&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;George&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dgeorge6@furl.net&quot;</span><span class="p">],</span>
</span><span id="__span-29-43"><a id="__codelineno-29-43" name="__codelineno-29-43"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Sean&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Gibson&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;sgibsony@alexa.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-44"><a id="__codelineno-29-44" name="__codelineno-29-44"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Virginia&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Graham&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;vgrahamk@aol.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-45"><a id="__codelineno-29-45" name="__codelineno-29-45"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Steven&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Hamilton&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;shamiltonu@state.tx.us&quot;</span><span class="p">],</span>
</span><span id="__span-29-46"><a id="__codelineno-29-46" name="__codelineno-29-46"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Virginia&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Hawkins&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;vhawkinsf@ehow.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-47"><a id="__codelineno-29-47" name="__codelineno-29-47"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Edward&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Hicks&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ehicksc@pcworld.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-48"><a id="__codelineno-29-48" name="__codelineno-29-48"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Mark&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Johnson&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mjohnsonj@hostgator.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-49"><a id="__codelineno-29-49" name="__codelineno-29-49"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Ruth&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Jordan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rjordan1a@smugmug.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-50"><a id="__codelineno-29-50" name="__codelineno-29-50"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Antonio&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Kim&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;akim4@odnoklassniki.ru&quot;</span><span class="p">],</span>
</span><span id="__span-29-51"><a id="__codelineno-29-51" name="__codelineno-29-51"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Jennifer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Marshall&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;jmarshallt@gnu.org&quot;</span><span class="p">],</span>
</span><span id="__span-29-52"><a id="__codelineno-29-52" name="__codelineno-29-52"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Eric&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Matthews&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ematthews5@independent.co.uk&quot;</span><span class="p">],</span>
</span><span id="__span-29-53"><a id="__codelineno-29-53" name="__codelineno-29-53"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Raymond&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Mcdonald&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;rmcdonald2@ihg.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-54"><a id="__codelineno-29-54" name="__codelineno-29-54"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Eric&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Miller&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;emillere@creativecommons.org&quot;</span><span class="p">],</span>
</span><span id="__span-29-55"><a id="__codelineno-29-55" name="__codelineno-29-55"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Jonathan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Morales&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;jmoralesa@ovh.net&quot;</span><span class="p">],</span>
</span><span id="__span-29-56"><a id="__codelineno-29-56" name="__codelineno-29-56"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Marie&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Morgan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mmorganb@cloudflare.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-57"><a id="__codelineno-29-57" name="__codelineno-29-57"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Amanda&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Nelson&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;anelson13@indiatimes.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-58"><a id="__codelineno-29-58" name="__codelineno-29-58"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Lisa&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Olson&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;lolsonr@telegraph.co.uk&quot;</span><span class="p">],</span>
</span><span id="__span-29-59"><a id="__codelineno-29-59" name="__codelineno-29-59"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Alice&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Ortiz&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;aortizw@histats.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-60"><a id="__codelineno-29-60" name="__codelineno-29-60"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Peter&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Phillips&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;pphillipss@1688.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-61"><a id="__codelineno-29-61" name="__codelineno-29-61"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Matthew&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Porter&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mporter9@europa.eu&quot;</span><span class="p">],</span>
</span><span id="__span-29-62"><a id="__codelineno-29-62" name="__codelineno-29-62"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Tammy&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Ray&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;trayx@weather.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-63"><a id="__codelineno-29-63" name="__codelineno-29-63"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Mark&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Richardson&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mrichardson1d@ihg.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-64"><a id="__codelineno-29-64" name="__codelineno-29-64"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Joan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Roberts&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;jroberts12@alibaba.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-65"><a id="__codelineno-29-65" name="__codelineno-29-65"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Kathleen&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Rose&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;kroseg@pinterest.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-66"><a id="__codelineno-29-66" name="__codelineno-29-66"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Steve&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Sanders&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ssanders1b@wikispaces.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-67"><a id="__codelineno-29-67" name="__codelineno-29-67"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Shirley&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Scott&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;sscottm@macromedia.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-68"><a id="__codelineno-29-68" name="__codelineno-29-68"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Lillian&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Stephens&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;lstephens19@hugedomains.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-69"><a id="__codelineno-29-69" name="__codelineno-29-69"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Nicole&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Thompson&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;nthompson3@admin.ch&quot;</span><span class="p">],</span>
</span><span id="__span-29-70"><a id="__codelineno-29-70" name="__codelineno-29-70"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Marie&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Thompson&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mthompsonz@yelp.com&quot;</span><span class="p">],</span>
</span><span id="__span-29-71"><a id="__codelineno-29-71" name="__codelineno-29-71"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Alan&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Vasquez&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;avasquezo@miibeian.gov.cn&quot;</span><span class="p">],</span>
</span><span id="__span-29-72"><a id="__codelineno-29-72" name="__codelineno-29-72"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Mildred&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Watkins&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mwatkins0@miibeian.gov.cn&quot;</span><span class="p">],</span>
</span><span id="__span-29-73"><a id="__codelineno-29-73" name="__codelineno-29-73"></a><span class="w">        </span><span class="p">[</span><span class="s2">&quot;Eugene&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Williams&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ewilliamsi@deliciousdays.com&quot;</span><span class="p">]</span>
</span><span id="__span-29-74"><a id="__codelineno-29-74" name="__codelineno-29-74"></a><span class="w">    </span><span class="p">];</span>
</span><span id="__span-29-75"><a id="__codelineno-29-75" name="__codelineno-29-75"></a><span class="w">    </span><span class="c1">// hierfuer muss pg-format installiert werden (wegen %L):</span>
</span><span id="__span-29-76"><a id="__codelineno-29-76" name="__codelineno-29-76"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">paramquery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">format</span><span class="p">(</span><span class="s1">&#39;INSERT INTO members(firstname, lastname, email) VALUES %L RETURNING *&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">values</span><span class="p">);</span>
</span><span id="__span-29-77"><a id="__codelineno-29-77" name="__codelineno-29-77"></a>
</span><span id="__span-29-78"><a id="__codelineno-29-78" name="__codelineno-29-78"></a>
</span><span id="__span-29-79"><a id="__codelineno-29-79" name="__codelineno-29-79"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-80"><a id="__codelineno-29-80" name="__codelineno-29-80"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">paramquery</span><span class="p">)</span>
</span><span id="__span-29-81"><a id="__codelineno-29-81" name="__codelineno-29-81"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;50 members inserted ...&quot;</span><span class="p">)</span>
</span><span id="__span-29-82"><a id="__codelineno-29-82" name="__codelineno-29-82"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">200</span><span class="p">)</span>
</span><span id="__span-29-83"><a id="__codelineno-29-83" name="__codelineno-29-83"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">)</span>
</span><span id="__span-29-84"><a id="__codelineno-29-84" name="__codelineno-29-84"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-85"><a id="__codelineno-29-85" name="__codelineno-29-85"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
</span><span id="__span-29-86"><a id="__codelineno-29-86" name="__codelineno-29-86"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-29-87"><a id="__codelineno-29-87" name="__codelineno-29-87"></a>
</span><span id="__span-29-88"><a id="__codelineno-29-88" name="__codelineno-29-88"></a><span class="p">});</span>
</span><span id="__span-29-89"><a id="__codelineno-29-89" name="__codelineno-29-89"></a>
</span><span id="__span-29-90"><a id="__codelineno-29-90" name="__codelineno-29-90"></a>
</span><span id="__span-29-91"><a id="__codelineno-29-91" name="__codelineno-29-91"></a><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">initdb</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Das Skript enthält zwei Anfragen an die Datenbank. Zunächst wird die Tabelle <code>members</code> gelöscht, falls sie existiert und dann erstellt. Das Ausführen dieser Anfrage erfolgt in Zeile <code>16</code>. Danach werden in einer zweiten Anfrage 50 Einträge in diese Tabelle eingefügt. Die Anfrage wird in Zeile <code>75</code> mithilfe des <code>pg-format</code>-Paketes formatiert (<code>format()</code>-Methode). Dadurch ist in dem Anfragestring der Platzhalter <code>%L</code> möglich, in den dann das verschachtelte Array <code>values</code> eingesetzt werden kann. Dadurch wird das Einfügen vieler Datensätze erleichtert.</p>
<p>Das Skript <code>initdb.js</code> wird in der <code>server.js</code> verwendet. Unter der Route <code>/init</code> wird es ausgeführt und alle Datensätze in die Datenbank eingetragen. </p>
<div class="tabbed-set tabbed-alternate" data-tabs="14:1"><input checked="checked" id="__tabbed_14_1" name="__tabbed_14" type="radio" /><div class="tabbed-labels"><label for="__tabbed_14_1">server.js</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-js highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-30-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-30-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-30-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-30-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-30-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-30-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-30-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-30-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-30-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-30-10">10</a></span>
<span class="normal"><a href="#__codelineno-30-11">11</a></span>
<span class="normal"><a href="#__codelineno-30-12">12</a></span>
<span class="normal"><a href="#__codelineno-30-13">13</a></span>
<span class="normal"><a href="#__codelineno-30-14">14</a></span>
<span class="normal"><a href="#__codelineno-30-15">15</a></span>
<span class="normal"><a href="#__codelineno-30-16">16</a></span>
<span class="normal"><a href="#__codelineno-30-17">17</a></span>
<span class="normal"><a href="#__codelineno-30-18">18</a></span>
<span class="normal"><a href="#__codelineno-30-19">19</a></span>
<span class="normal"><a href="#__codelineno-30-20">20</a></span>
<span class="normal"><a href="#__codelineno-30-21">21</a></span>
<span class="normal"><a href="#__codelineno-30-22">22</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">cors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;cors&#39;</span><span class="p">);</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;dotenv&#39;</span><span class="p">).</span><span class="nx">config</span><span class="p">();</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">routes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./routes&#39;</span><span class="p">);</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="hll"><span class="kd">const</span><span class="w"> </span><span class="nx">init</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./initdb&#39;</span><span class="p">);</span>
</span></span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6"></a>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="kd">const</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">();</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="kd">const</span><span class="w"> </span><span class="nx">PORT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3000</span><span class="p">;</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9"></a>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">express</span><span class="p">.</span><span class="nx">json</span><span class="p">());</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">cors</span><span class="p">());</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12"></a><span class="hll"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/init&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">init</span><span class="p">);</span>
</span></span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13"></a><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">routes</span><span class="p">);</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14"></a>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15"></a>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16"></a><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">PORT</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Server started and listening on port </span><span class="si">${</span><span class="nx">PORT</span><span class="si">}</span><span class="sb"> ...`</span><span class="p">);</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22"></a><span class="p">})</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Wenn wir nun <code>http://localhost:3000/init</code> aufrufen, wird die Datenbank automatisch befüllt. </p>
</li>
</ol>
<h2 id="crud-funktionen">CRUD-Funktionen<a class="headerlink" href="#crud-funktionen" title="Permanent link">&para;</a></h2>
<p>Nun fügen wir in die <code>routes.js</code> die einzelnen Routen ein, um die CRUD-Funktionen zu implementieren. Wir beginnen mit dem Erzeugen eines neuen Datensatzes: </p>
<h3 id="c-create">C - create<a class="headerlink" href="#c-create" title="Permanent link">&para;</a></h3>
<p>Wir implementieren den Endpunkt <code>POST localhost:3000/members</code>. Es wird also die HTTP-<code>POST</code>-Anfragemethoden verwendet.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="15:1"><input checked="checked" id="__tabbed_15_1" name="__tabbed_15" type="radio" /><div class="tabbed-labels"><label for="__tabbed_15_1">routes.js</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-js highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-31-18">18</a></span>
<span class="normal"><a href="#__codelineno-31-19">19</a></span>
<span class="normal"><a href="#__codelineno-31-20">20</a></span>
<span class="normal"><a href="#__codelineno-31-21">21</a></span>
<span class="normal"><a href="#__codelineno-31-22">22</a></span>
<span class="normal"><a href="#__codelineno-31-23">23</a></span>
<span class="normal"><a href="#__codelineno-31-24">24</a></span>
<span class="normal"><a href="#__codelineno-31-25">25</a></span>
<span class="normal"><a href="#__codelineno-31-26">26</a></span>
<span class="normal"><a href="#__codelineno-31-27">27</a></span>
<span class="normal"><a href="#__codelineno-31-28">28</a></span>
<span class="normal"><a href="#__codelineno-31-29">29</a></span>
<span class="normal"><a href="#__codelineno-31-30">30</a></span>
<span class="normal"><a href="#__codelineno-31-31">31</a></span>
<span class="normal"><a href="#__codelineno-31-32">32</a></span>
<span class="normal"><a href="#__codelineno-31-33">33</a></span>
<span class="normal"><a href="#__codelineno-31-34">34</a></span>
<span class="normal"><a href="#__codelineno-31-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18"></a><span class="c1">// post one member</span>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19"></a><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/members&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">firstname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstname</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstname</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lastname</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lastname</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23"></a>
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`INSERT INTO members(firstname, lastname, email) VALUES ($1, $2, $3) RETURNING *`</span><span class="p">;</span>
</span><span id="__span-31-25"><a id="__codelineno-31-25" name="__codelineno-31-25"></a>
</span><span id="__span-31-26"><a id="__codelineno-31-26" name="__codelineno-31-26"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-27"><a id="__codelineno-31-27" name="__codelineno-31-27"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">firstname</span><span class="p">,</span><span class="w"> </span><span class="nx">lastname</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="p">])</span>
</span><span id="__span-31-28"><a id="__codelineno-31-28" name="__codelineno-31-28"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
</span><span id="__span-31-29"><a id="__codelineno-31-29" name="__codelineno-31-29"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
</span><span id="__span-31-30"><a id="__codelineno-31-30" name="__codelineno-31-30"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-31"><a id="__codelineno-31-31" name="__codelineno-31-31"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">)</span>
</span><span id="__span-31-32"><a id="__codelineno-31-32" name="__codelineno-31-32"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-31-33"><a id="__codelineno-31-33" name="__codelineno-31-33"></a><span class="p">});</span>
</span><span id="__span-31-34"><a id="__codelineno-31-34" name="__codelineno-31-34"></a>
</span><span id="__span-31-35"><a id="__codelineno-31-35" name="__codelineno-31-35"></a><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">router</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Erläuterungen: </p>
<ul>
<li>Aufruf der <code>POST</code>-Anfragemethode mittels <code>router.post()</code>. Der erste Parameter der Funktion ist die Route <code>/members</code>. Der zweite Parameter ist eine Callback-Funktion. </li>
<li>
<p>Die Parameter dieser Callback-Funktion sind ein <code>Request</code>- und ein <code>Response</code>-Objekt. Wir haben sie hier mit <code>req</code> und <code>res</code> benannt. Siehe dazu auch <a href="https://expressjs.com/en/4x/api.html#req">Request</a> und <a href="https://expressjs.com/en/4x/api.html#res">Response</a>. </p>
</li>
<li>
<p>Das <code>Request</code>-Objekt besitzt Eigenschaften für die Parameter, den Body, HTTP-Header, Cookies usw. Wir greifen mithilfe von <code>req.body</code> auf den Body des <code>Request</code>-Objektes zu. In diesem Body schicken wir den neuen Datensatz mit, der in die Datenbank eingefügt werden soll. </p>
</li>
<li>Die Daten aus dem Body werden ausgelesen und entsprechend in den Variablen <code>firstname</code>, <code>lastname</code> und <code>email</code> gespeichert. </li>
<li>Die SQL-Anfrage <code>query</code> ist <code>INSERT INTO ...</code> Darin gibt die Parameter <code>$1, $2, $3</code> </li>
<li>Die Ausführung der <code>query</code> erfolgt mittels <code>client.query()</code>. Dieser Funktion werden 2 Parameter übergeben: die <code>query</code> und ein Array mit den Werten, die in die Parameter (in der Reihenfolge) eingesetzt werden. </li>
<li>
<p>Die Ausführung der <code>query</code> in der Datenbank gibt ein <code>result</code> zurück. Beim Einfügen mithilfe von <code>INSERT INTO ...</code> Dabei handelt es sich um ein Objekt, das verschiedene Eigenschaften enthält, z.B. (gekürzt):</p>
<p><div class="language-json highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="err">Resul</span><span class="kc">t</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="w">  </span><span class="err">comma</span><span class="kc">n</span><span class="err">d</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;INSERT&#39;</span><span class="p">,</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="w">  </span><span class="err">rowCou</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a><span class="w">  </span><span class="err">oid</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="w">  </span><span class="err">rows</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="w">      </span><span class="err">id</span><span class="p">:</span><span class="w"> </span><span class="mi">51</span><span class="p">,</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="w">      </span><span class="kc">f</span><span class="err">irs</span><span class="kc">tna</span><span class="err">me</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Maria&#39;</span><span class="p">,</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="w">      </span><span class="err">las</span><span class="kc">tna</span><span class="err">me</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Mus</span><span class="kc">terfrau</span><span class="err">&#39;</span><span class="p">,</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="w">      </span><span class="err">email</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;maria@mus</span><span class="kc">terfrau</span><span class="err">.</span><span class="kc">fr</span><span class="err">&#39;</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a><span class="w">  </span><span class="kc">f</span><span class="err">ields</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="w">    </span><span class="err">Field</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="w">      </span><span class="kc">na</span><span class="err">me</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;id&#39;</span><span class="p">,</span>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a><span class="w">      </span><span class="kc">ta</span><span class="err">bleID</span><span class="p">:</span><span class="w"> </span><span class="mi">16392</span><span class="p">,</span>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a><span class="w">      </span><span class="err">colum</span><span class="kc">n</span><span class="err">ID</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a><span class="w">      </span><span class="err">da</span><span class="kc">ta</span><span class="err">TypeID</span><span class="p">:</span><span class="w"> </span><span class="mi">23</span><span class="p">,</span>
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a><span class="w">      </span><span class="err">da</span><span class="kc">ta</span><span class="err">TypeSize</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span>
</span><span id="__span-32-20"><a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a><span class="w">      </span><span class="err">da</span><span class="kc">ta</span><span class="err">TypeModi</span><span class="kc">f</span><span class="err">ier</span><span class="p">:</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span>
</span><span id="__span-32-21"><a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a><span class="w">      </span><span class="kc">f</span><span class="err">orma</span><span class="kc">t</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;</span><span class="kc">te</span><span class="err">x</span><span class="kc">t</span><span class="err">&#39;</span>
</span><span id="__span-32-22"><a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a><span class="w">    </span><span class="p">},</span>
</span></code></pre></div>
Es beinhaltet z.B. die betroffenen Tabellenzeilen (<code>rowCount: 1</code> und <code>rows: [...]</code>), wobei <code>rows</code> ein Array aller Datensätze enthält, die hinzugefügt wurden.
- Den ersten (einzigen) Eintrag des Arrays <code>result.rows</code> geben wir mithilfe von <code>res.send(result.rows[0])</code> als <code>Response</code> zurück. 
- Sollte bei der Anfrage an die Datenbank ein Fehler auftreten, wird dieser mittels <code>catch(err)</code> aufgefanden und das Fehler-Objekt auf die Konsole ausgegeben. </p>
</li>
</ul>
<p>Mithilfe von Postman können wir die Funktionalität des <code>POST /members</code>-Endpunktes ausprobieren. Dazu wählen wir den korrekten Endpunkt <code>http://localhost:3000/members</code> und die Anfragemethode <code>POST</code>. </p>
<p><img alt="backend" src="../files/300_backend.png" /></p>
<p>Außerdem fügen wir in den <code>Body</code> des <code>Request</code>-Objektes das einzufügende Objekt im JSON-Format, z.B.:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="p">{</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">    </span><span class="nt">&quot;firstname&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Maria&quot;</span><span class="p">,</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">    </span><span class="nt">&quot;lastname&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Musterfrau&quot;</span><span class="p">,</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;maria@musterfrau.fr&quot;</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>Beachten Sie, dass Sie im <code>Request</code>-Teil, dort wo Sie auch im Body das obige JSON einfügen, den Radiobutton <code>raw</code> auswählen und als Format <code>JSON</code>. Mit dem <code>Send</code>-Button schicken Sie die Anfrage ab und im <code>Response</code>-teil erscheint der eingefügte Datensatz. Diesem wurde durch die Datenbank eine <code>id</code> hinzugefügt:</p>
<p><img alt="backend" src="../files/299_backend.png" /></p>
<p>Das generelle Prinzip der parametrisierten SQL-Anfragen wird für <code>POST /members</code> deutlich. Wir definieren uns eine <em>parametrisierte SQL-Anfrage</em> mit den Parametern <code>$1</code>, <code>$2</code>, <code>$3</code>: </p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`INSERT INTO members(firstname, lastname, email) VALUES ($1, $2, $3) RETURNING *`</span><span class="p">;</span>
</span></code></pre></div>
<p>In die Parameter <code>$1</code>, <code>$2</code> und <code>$3</code> werden dann die entsprechenden Werte eingetragen:</p>
<div class="language-js highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">firstname</span><span class="p">,</span><span class="w"> </span><span class="nx">lastname</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="p">]);</span>
</span></code></pre></div>
<p>Wichtig ist, dass die Werte als Array übergeben werden. Der Funktion <code>client.query()</code> wird also die parametrisierte Anfrage übergeben und als zweiter Parameter folgt das Array mit den Werten (in korrekter Reihenfolge), die in die Parameter eingesetzt werden. </p>
<p>Wir haben nun den ersten Endpunkt unserer REST-API implementiert. Weiter geht es mit dem Lesen eines oder mehrerer Datensätze.</p>
<h3 id="r-read-all">R - read all<a class="headerlink" href="#r-read-all" title="Permanent link">&para;</a></h3>
<p>Das Auslesen aller Datensätze aus der Datenbank erfolgt über den Endpunkt <code>GET / members</code>. In der <code>routes.js</code> implementieren wir dazu folgende Funktion:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="16:1"><input checked="checked" id="__tabbed_16_1" name="__tabbed_16" type="radio" /><div class="tabbed-labels"><label for="__tabbed_16_1">routes.js</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-js highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-36-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-36-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-36-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-36-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-36-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-36-10">10</a></span>
<span class="normal"><a href="#__codelineno-36-11">11</a></span>
<span class="normal"><a href="#__codelineno-36-12">12</a></span>
<span class="normal"><a href="#__codelineno-36-13">13</a></span>
<span class="normal"><a href="#__codelineno-36-14">14</a></span>
<span class="normal"><a href="#__codelineno-36-15">15</a></span>
<span class="normal"><a href="#__codelineno-36-16">16</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="c1">// get all members</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6"></a><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/members&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`SELECT * FROM members `</span><span class="p">;</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8"></a>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">);</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">)</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16"></a><span class="p">});</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Es wird also die <code>get()</code>-Funktion von Express gewählt. Die Anfrage an die Datenbank ist dieses Mal parameterlos ein einfaches <code>SELECT * FROM members</code>. Als Resultat der Anfrage enthält <code>rows</code> alle Datenbankeinträge. Diese werden als <code>Response</code> zurückgesendet. </p>
<p>In Postman wählen wir <code>GET</code> und geben <code>http:localhost:3000/members</code> ein. Der Body des <code>Request</code>-Objektes bleibt bei <code>GET</code> leer. </p>
<p><img alt="backend" src="../files/301_backend.png" /></p>
<h3 id="r-read-one">R - read one<a class="headerlink" href="#r-read-one" title="Permanent link">&para;</a></h3>
<p>Durch das Einfügen der Datensätze in die Datenbank erhalten diese vom Datenbankmanagementsystem eine eindeutige <code>id</code>. Wir erstellen uns einen Endpunkt, der uns für eine gegebene <code>id</code> den entsprechenden Datensatz zurückgibt:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="17:1"><input checked="checked" id="__tabbed_17_1" name="__tabbed_17" type="radio" /><div class="tabbed-labels"><label for="__tabbed_17_1">routes.js</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-js highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-37-35">35</a></span>
<span class="normal"><a href="#__codelineno-37-36">36</a></span>
<span class="normal"><a href="#__codelineno-37-37">37</a></span>
<span class="normal"><a href="#__codelineno-37-38">38</a></span>
<span class="normal"><a href="#__codelineno-37-39">39</a></span>
<span class="normal"><a href="#__codelineno-37-40">40</a></span>
<span class="normal"><a href="#__codelineno-37-41">41</a></span>
<span class="normal"><a href="#__codelineno-37-42">42</a></span>
<span class="normal"><a href="#__codelineno-37-43">43</a></span>
<span class="normal"><a href="#__codelineno-37-44">44</a></span>
<span class="normal"><a href="#__codelineno-37-45">45</a></span>
<span class="normal"><a href="#__codelineno-37-46">46</a></span>
<span class="normal"><a href="#__codelineno-37-47">47</a></span>
<span class="normal"><a href="#__codelineno-37-48">48</a></span>
<span class="normal"><a href="#__codelineno-37-49">49</a></span>
<span class="normal"><a href="#__codelineno-37-50">50</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-37-35"><a id="__codelineno-37-35" name="__codelineno-37-35"></a><span class="c1">// get one member via id</span>
</span><span id="__span-37-36"><a id="__codelineno-37-36" name="__codelineno-37-36"></a><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/members/:id&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-37"><a id="__codelineno-37-37" name="__codelineno-37-37"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`SELECT * FROM members WHERE id=$1`</span><span class="p">;</span>
</span><span id="__span-37-38"><a id="__codelineno-37-38" name="__codelineno-37-38"></a>
</span><span id="__span-37-39"><a id="__codelineno-37-39" name="__codelineno-37-39"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-40"><a id="__codelineno-37-40" name="__codelineno-37-40"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-37-41"><a id="__codelineno-37-41" name="__codelineno-37-41"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">id</span><span class="p">])</span>
</span><span id="__span-37-42"><a id="__codelineno-37-42" name="__codelineno-37-42"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
</span><span id="__span-37-43"><a id="__codelineno-37-43" name="__codelineno-37-43"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rowCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
</span><span id="__span-37-44"><a id="__codelineno-37-44" name="__codelineno-37-44"></a><span class="w">            </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
</span><span id="__span-37-45"><a id="__codelineno-37-45" name="__codelineno-37-45"></a><span class="w">        </span><span class="k">else</span>
</span><span id="__span-37-46"><a id="__codelineno-37-46" name="__codelineno-37-46"></a><span class="w">            </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;No member found with id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-37-47"><a id="__codelineno-37-47" name="__codelineno-37-47"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-48"><a id="__codelineno-37-48" name="__codelineno-37-48"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">)</span>
</span><span id="__span-37-49"><a id="__codelineno-37-49" name="__codelineno-37-49"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-37-50"><a id="__codelineno-37-50" name="__codelineno-37-50"></a><span class="p">});</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Erläuterungen: </p>
<ul>
<li>Die <code>id</code> wird mittels <code>/members/:id</code> als Parameter an die Route anghängt. </li>
<li>Dieses Parameter kann mittels <code>req.params.id</code> aus dem <code>Request</code>-Objekt ausgelesen werden. </li>
<li>Die Anfrage <code>query</code> ist erneut parametrisiert <code>$1</code>. bei Aufruf von <code>client.query()</code> wird als erster Parameter diese parametrisierte <code>query</code> und als zweiter Parameter ein Array übergeben, welches den Wert für <code>id</code> enthält. </li>
<li>
<p>Das <code>result</code>-Objekt, das die <code>client.query()</code>-Funktion zurückgibt, enthält nun entweder den Datensatz mit der gesuchten <code>id</code>: </p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="err">Resul</span><span class="kc">t</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="w">  </span><span class="err">comma</span><span class="kc">n</span><span class="err">d</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;SELECT&#39;</span><span class="p">,</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">  </span><span class="err">rowCou</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">  </span><span class="err">oid</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="w">  </span><span class="err">rows</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">      </span><span class="err">id</span><span class="p">:</span><span class="w"> </span><span class="mi">51</span><span class="p">,</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="w">      </span><span class="kc">f</span><span class="err">irs</span><span class="kc">tna</span><span class="err">me</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Maria&#39;</span><span class="p">,</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="w">      </span><span class="err">las</span><span class="kc">tna</span><span class="err">me</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;Mus</span><span class="kc">terfrau</span><span class="err">&#39;</span><span class="p">,</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="w">      </span><span class="err">email</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;maria@mus</span><span class="kc">terfrau</span><span class="err">.</span><span class="kc">fr</span><span class="err">&#39;</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="w">  </span><span class="p">],</span>
</span></code></pre></div>
<p>oder, falls die <code>id</code> nicht existiert, ein leeres <code>rows</code>-Array:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="err">Resul</span><span class="kc">t</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="w">    </span><span class="err">comma</span><span class="kc">n</span><span class="err">d</span><span class="p">:</span><span class="w"> </span><span class="err">&#39;SELECT&#39;</span><span class="p">,</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="w">    </span><span class="err">rowCou</span><span class="kc">nt</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="w">    </span><span class="err">oid</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="w">    </span><span class="err">rows</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span>
</span></code></pre></div>
</li>
<li>
<p>Für diese Fallunterscheidung fragen wir den Wert von <code>rowCount</code> im <code>results</code>-Objekt ab. Ist dieser Wert <code>1</code> senden wir mittels <code>res.send(result.rows[0]);</code> den Datensatz. ist der Wert <code>0</code> senden wir ein Objekt mit einer <code>message</code>. </p>
</li>
</ul>
<p>In Postman sehen diese beiden Fälle so aus:</p>
<p><img alt="backend" src="../files/302_backend.png" /></p>
<p><img alt="backend" src="../files/303_backend.png" /></p>
<h3 id="u-update">U - update<a class="headerlink" href="#u-update" title="Permanent link">&para;</a></h3>
<p>Das Ändern eines bereits existierenden Datensatzes ist der komplizierteste Fall. Wir verwenden die <code>PUT</code>-Anfragemethode. Anstelle von <code>PUT</code> kann auch <code>PATCH</code> verwendet werden. Zur Unterscheidung zwischen <code>PUT</code> und <code>PATCH</code> siehe z.B. <a href="https://www.geeksforgeeks.org/difference-between-put-and-patch-request/">hier</a> oder <a href="https://stackoverflow.com/questions/21660791/what-is-the-main-difference-between-patch-and-put-request">hier</a>.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="18:1"><input checked="checked" id="__tabbed_18_1" name="__tabbed_18" type="radio" /><div class="tabbed-labels"><label for="__tabbed_18_1">routes.js</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-js highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-40-59">59</a></span>
<span class="normal"><a href="#__codelineno-40-60">60</a></span>
<span class="normal"><a href="#__codelineno-40-61">61</a></span>
<span class="normal"><a href="#__codelineno-40-62">62</a></span>
<span class="normal"><a href="#__codelineno-40-63">63</a></span>
<span class="normal"><a href="#__codelineno-40-64">64</a></span>
<span class="normal"><a href="#__codelineno-40-65">65</a></span>
<span class="normal"><a href="#__codelineno-40-66">66</a></span>
<span class="normal"><a href="#__codelineno-40-67">67</a></span>
<span class="normal"><a href="#__codelineno-40-68">68</a></span>
<span class="normal"><a href="#__codelineno-40-69">69</a></span>
<span class="normal"><a href="#__codelineno-40-70">70</a></span>
<span class="normal"><a href="#__codelineno-40-71">71</a></span>
<span class="normal"><a href="#__codelineno-40-72">72</a></span>
<span class="normal"><a href="#__codelineno-40-73">73</a></span>
<span class="normal"><a href="#__codelineno-40-74">74</a></span>
<span class="normal"><a href="#__codelineno-40-75">75</a></span>
<span class="normal"><a href="#__codelineno-40-76">76</a></span>
<span class="normal"><a href="#__codelineno-40-77">77</a></span>
<span class="normal"><a href="#__codelineno-40-78">78</a></span>
<span class="normal"><a href="#__codelineno-40-79">79</a></span>
<span class="normal"><a href="#__codelineno-40-80">80</a></span>
<span class="normal"><a href="#__codelineno-40-81">81</a></span>
<span class="normal"><a href="#__codelineno-40-82">82</a></span>
<span class="normal"><a href="#__codelineno-40-83">83</a></span>
<span class="normal"><a href="#__codelineno-40-84">84</a></span>
<span class="normal"><a href="#__codelineno-40-85">85</a></span>
<span class="normal"><a href="#__codelineno-40-86">86</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-40-59"><a id="__codelineno-40-59" name="__codelineno-40-59"></a><span class="c1">// update one member</span>
</span><span id="__span-40-60"><a id="__codelineno-40-60" name="__codelineno-40-60"></a><span class="nx">router</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;/members/:id&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-61"><a id="__codelineno-40-61" name="__codelineno-40-61"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`SELECT * FROM members WHERE id=$1`</span><span class="p">;</span>
</span><span id="__span-40-62"><a id="__codelineno-40-62" name="__codelineno-40-62"></a>
</span><span id="__span-40-63"><a id="__codelineno-40-63" name="__codelineno-40-63"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-40-64"><a id="__codelineno-40-64" name="__codelineno-40-64"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">id</span><span class="p">])</span>
</span><span id="__span-40-65"><a id="__codelineno-40-65" name="__codelineno-40-65"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rowCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
</span><span id="__span-40-66"><a id="__codelineno-40-66" name="__codelineno-40-66"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-40-67"><a id="__codelineno-40-67" name="__codelineno-40-67"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">member</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
</span><span id="__span-40-68"><a id="__codelineno-40-68" name="__codelineno-40-68"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">firstname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstname</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstname</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">member</span><span class="p">.</span><span class="nx">firstname</span><span class="p">;</span>
</span><span id="__span-40-69"><a id="__codelineno-40-69" name="__codelineno-40-69"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lastname</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lastname</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">member</span><span class="p">.</span><span class="nx">lastname</span><span class="p">;</span>
</span><span id="__span-40-70"><a id="__codelineno-40-70" name="__codelineno-40-70"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">member</span><span class="p">.</span><span class="nx">email</span><span class="p">;</span>
</span><span id="__span-40-71"><a id="__codelineno-40-71" name="__codelineno-40-71"></a>
</span><span id="__span-40-72"><a id="__codelineno-40-72" name="__codelineno-40-72"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">updatequery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`UPDATE members SET </span>
</span><span id="__span-40-73"><a id="__codelineno-40-73" name="__codelineno-40-73"></a><span class="sb">            firstname = $1, </span>
</span><span id="__span-40-74"><a id="__codelineno-40-74" name="__codelineno-40-74"></a><span class="sb">            lastname = $2,</span>
</span><span id="__span-40-75"><a id="__codelineno-40-75" name="__codelineno-40-75"></a><span class="sb">            email = $3</span>
</span><span id="__span-40-76"><a id="__codelineno-40-76" name="__codelineno-40-76"></a><span class="sb">            WHERE id=$4;`</span><span class="p">;</span>
</span><span id="__span-40-77"><a id="__codelineno-40-77" name="__codelineno-40-77"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">updateresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">updatequery</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">firstname</span><span class="p">,</span><span class="w"> </span><span class="nx">lastname</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="p">]);</span>
</span><span id="__span-40-78"><a id="__codelineno-40-78" name="__codelineno-40-78"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">updateresult</span><span class="p">)</span>
</span><span id="__span-40-79"><a id="__codelineno-40-79" name="__codelineno-40-79"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span><span class="w"> </span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">firstname</span><span class="p">,</span><span class="w"> </span><span class="nx">lastname</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-40-80"><a id="__codelineno-40-80" name="__codelineno-40-80"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-81"><a id="__codelineno-40-81" name="__codelineno-40-81"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">)</span>
</span><span id="__span-40-82"><a id="__codelineno-40-82" name="__codelineno-40-82"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
</span><span id="__span-40-83"><a id="__codelineno-40-83" name="__codelineno-40-83"></a><span class="w">            </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Member with id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; does not exist!&quot;</span>
</span><span id="__span-40-84"><a id="__codelineno-40-84" name="__codelineno-40-84"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-40-85"><a id="__codelineno-40-85" name="__codelineno-40-85"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-86"><a id="__codelineno-40-86" name="__codelineno-40-86"></a><span class="p">});</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Erläuterungen: </p>
<ul>
<li>Das <code>Update</code> ist eine Kombination aus <code>Read (one)</code> und <code>Create</code>. Soll ein existierender Datensatz geändert werden, benötigen wir die <code>id</code> dieses Datensatzes als Parameter sowie die zu ändernden Daten im Body des <code>Request</code>-Objektes. </li>
<li>Zunächst prüfen wir mithilfe von <code>SELECT * ... WHERE id=$1</code>, ob es in der Datenbank einen Datensatz mit der entsprechenden <code>id</code> gibt. Die <code>id</code> wird als Parameter ausgelesen (<code>req.params.id</code>) und als Parameterwert der <code>query</code> übergeben. </li>
<li>Das <code>result</code> der <code>client.query()</code>-Funktion enthält entweder den Datensatz mit der <code>id</code> oder es enthält keinen Datensatz (falls die <code>id</code> nicht existiert).</li>
<li>
<p>Falls die <code>id</code> nicht in der Datenbank existiert, wird der HTTP-Statuscode <code>404</code> sowie ein Objekt mit einer <code>error</code>-Nachricht als <code>Response</code> gesendet:</p>
<p><img alt="backend" src="../files/305_backend.png" /></p>
</li>
<li>
<p>Falls der Datensatz existiert, werden die Einträge aus der Datenbank gespeichert (in <code>member</code>). Sodann wird der <code>body</code> des <code>Request</code>-Objektes ausgelesen. Die Variablen <code>firstname</code>, <code>lastname</code> und <code>email</code> enthalten nun entweder die Werte aus dem <code>Request-Body</code> (geänderte Werte) oder aus <code>member</code> (alte Werte). Das bedeutet, dass das im <code>body</code> gesendete Objekt kein vollständiges <code>Member</code>-Objekt sein muss (es genügt <code>firstname</code> und/oder <code>lastname</code> und/oder <code>email</code>). </p>
</li>
<li>
<p>Mit einer <code>UPDATE ...</code>-Anfrage wird der Datensatz in der Datenbank geändert. Als <code>updateresult</code> wird der gänderte Datensatz als <code>Response</code> gesendet.</p>
<p><img alt="backend" src="../files/304_backend.png" /></p>
</li>
</ul>
<h3 id="d-delete">D - delete<a class="headerlink" href="#d-delete" title="Permanent link">&para;</a></h3>
<p>Zuletzt erzeugen wir noch einen Endpunkt, mit dem das Löschen eines Datensatzes möglich wird. Dazu verwenden wir die Anfragemethode <code>DELETE</code>. Die Route ist mit einer <code>id</code> parametrisiert. Über diese <code>id</code> wird der Datensatz gelöscht, falls die <code>id</code> in der Datenbank existiert: </p>
<div class="tabbed-set tabbed-alternate" data-tabs="19:1"><input checked="checked" id="__tabbed_19_1" name="__tabbed_19" type="radio" /><div class="tabbed-labels"><label for="__tabbed_19_1">routes.js</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-js highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-41-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-41-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-41-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-41-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-41-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-41-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-41-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-41-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-41-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-41-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-41-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-41-100">100</a></span>
<span class="normal"><a href="#__codelineno-41-101">101</a></span>
<span class="normal"><a href="#__codelineno-41-102">102</a></span>
<span class="normal"><a href="#__codelineno-41-103">103</a></span>
<span class="normal"><a href="#__codelineno-41-104">104</a></span>
<span class="normal"><a href="#__codelineno-41-105">105</a></span>
<span class="normal"><a href="#__codelineno-41-106">106</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-41-89"><a id="__codelineno-41-89" name="__codelineno-41-89"></a><span class="c1">// delete one member via id</span>
</span><span id="__span-41-90"><a id="__codelineno-41-90" name="__codelineno-41-90"></a><span class="nx">router</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="s1">&#39;/members/:id&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-91"><a id="__codelineno-41-91" name="__codelineno-41-91"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`DELETE FROM members WHERE id=$1`</span><span class="p">;</span>
</span><span id="__span-41-92"><a id="__codelineno-41-92" name="__codelineno-41-92"></a>
</span><span id="__span-41-93"><a id="__codelineno-41-93" name="__codelineno-41-93"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-94"><a id="__codelineno-41-94" name="__codelineno-41-94"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-41-95"><a id="__codelineno-41-95" name="__codelineno-41-95"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">id</span><span class="p">])</span>
</span><span id="__span-41-96"><a id="__codelineno-41-96" name="__codelineno-41-96"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
</span><span id="__span-41-97"><a id="__codelineno-41-97" name="__codelineno-41-97"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rowCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
</span><span id="__span-41-98"><a id="__codelineno-41-98" name="__codelineno-41-98"></a><span class="w">            </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Member with id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; deleted&quot;</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-41-99"><a id="__codelineno-41-99" name="__codelineno-41-99"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-100"><a id="__codelineno-41-100" name="__codelineno-41-100"></a><span class="w">            </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">)</span>
</span><span id="__span-41-101"><a id="__codelineno-41-101" name="__codelineno-41-101"></a><span class="w">            </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;No member found with id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-41-102"><a id="__codelineno-41-102" name="__codelineno-41-102"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-41-103"><a id="__codelineno-41-103" name="__codelineno-41-103"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-41-104"><a id="__codelineno-41-104" name="__codelineno-41-104"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">)</span>
</span><span id="__span-41-105"><a id="__codelineno-41-105" name="__codelineno-41-105"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-41-106"><a id="__codelineno-41-106" name="__codelineno-41-106"></a><span class="p">});</span>
</span></code></pre></div></td></tr></table></div>
</div>
</div>
</div>
<p>Zurückgesendet wird in beiden Fällen ein Objekt mit einer <code>message</code>-Eigenschaft. Für den Fall, dass die <code>id</code> nicht in der Datenbank existiert, wird außerdem der HTTP-Statuscode <code>404</code> gesendet:</p>
<p><img alt="backend" src="../files/306_backend.png" /></p>
<p>Wurde der entsprechende Eintrag gelöscht, erscheint:</p>
<p><img alt="backend" src="../files/307_backend.png" /></p>
<p>Hier nochmal die vollständige <code>routes.js</code>:</p>
<details>
<summary>routes.js</summary>
<div class="language-js highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-42-1">  1</a></span>
<span class="normal"><a href="#__codelineno-42-2">  2</a></span>
<span class="normal"><a href="#__codelineno-42-3">  3</a></span>
<span class="normal"><a href="#__codelineno-42-4">  4</a></span>
<span class="normal"><a href="#__codelineno-42-5">  5</a></span>
<span class="normal"><a href="#__codelineno-42-6">  6</a></span>
<span class="normal"><a href="#__codelineno-42-7">  7</a></span>
<span class="normal"><a href="#__codelineno-42-8">  8</a></span>
<span class="normal"><a href="#__codelineno-42-9">  9</a></span>
<span class="normal"><a href="#__codelineno-42-10"> 10</a></span>
<span class="normal"><a href="#__codelineno-42-11"> 11</a></span>
<span class="normal"><a href="#__codelineno-42-12"> 12</a></span>
<span class="normal"><a href="#__codelineno-42-13"> 13</a></span>
<span class="normal"><a href="#__codelineno-42-14"> 14</a></span>
<span class="normal"><a href="#__codelineno-42-15"> 15</a></span>
<span class="normal"><a href="#__codelineno-42-16"> 16</a></span>
<span class="normal"><a href="#__codelineno-42-17"> 17</a></span>
<span class="normal"><a href="#__codelineno-42-18"> 18</a></span>
<span class="normal"><a href="#__codelineno-42-19"> 19</a></span>
<span class="normal"><a href="#__codelineno-42-20"> 20</a></span>
<span class="normal"><a href="#__codelineno-42-21"> 21</a></span>
<span class="normal"><a href="#__codelineno-42-22"> 22</a></span>
<span class="normal"><a href="#__codelineno-42-23"> 23</a></span>
<span class="normal"><a href="#__codelineno-42-24"> 24</a></span>
<span class="normal"><a href="#__codelineno-42-25"> 25</a></span>
<span class="normal"><a href="#__codelineno-42-26"> 26</a></span>
<span class="normal"><a href="#__codelineno-42-27"> 27</a></span>
<span class="normal"><a href="#__codelineno-42-28"> 28</a></span>
<span class="normal"><a href="#__codelineno-42-29"> 29</a></span>
<span class="normal"><a href="#__codelineno-42-30"> 30</a></span>
<span class="normal"><a href="#__codelineno-42-31"> 31</a></span>
<span class="normal"><a href="#__codelineno-42-32"> 32</a></span>
<span class="normal"><a href="#__codelineno-42-33"> 33</a></span>
<span class="normal"><a href="#__codelineno-42-34"> 34</a></span>
<span class="normal"><a href="#__codelineno-42-35"> 35</a></span>
<span class="normal"><a href="#__codelineno-42-36"> 36</a></span>
<span class="normal"><a href="#__codelineno-42-37"> 37</a></span>
<span class="normal"><a href="#__codelineno-42-38"> 38</a></span>
<span class="normal"><a href="#__codelineno-42-39"> 39</a></span>
<span class="normal"><a href="#__codelineno-42-40"> 40</a></span>
<span class="normal"><a href="#__codelineno-42-41"> 41</a></span>
<span class="normal"><a href="#__codelineno-42-42"> 42</a></span>
<span class="normal"><a href="#__codelineno-42-43"> 43</a></span>
<span class="normal"><a href="#__codelineno-42-44"> 44</a></span>
<span class="normal"><a href="#__codelineno-42-45"> 45</a></span>
<span class="normal"><a href="#__codelineno-42-46"> 46</a></span>
<span class="normal"><a href="#__codelineno-42-47"> 47</a></span>
<span class="normal"><a href="#__codelineno-42-48"> 48</a></span>
<span class="normal"><a href="#__codelineno-42-49"> 49</a></span>
<span class="normal"><a href="#__codelineno-42-50"> 50</a></span>
<span class="normal"><a href="#__codelineno-42-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-42-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-42-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-42-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-42-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-42-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-42-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-42-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-42-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-42-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-42-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-42-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-42-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-42-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-42-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-42-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-42-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-42-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-42-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-42-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-42-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-42-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-42-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-42-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-42-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-42-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-42-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-42-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-42-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-42-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-42-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-42-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-42-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-42-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-42-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-42-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-42-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-42-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-42-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-42-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-42-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-42-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-42-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-42-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-42-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-42-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-42-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-42-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-42-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-42-100">100</a></span>
<span class="normal"><a href="#__codelineno-42-101">101</a></span>
<span class="normal"><a href="#__codelineno-42-102">102</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">express</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">);</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="kd">const</span><span class="w"> </span><span class="nx">client</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./db&#39;</span><span class="p">);</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="kd">const</span><span class="w"> </span><span class="nx">router</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">express</span><span class="p">.</span><span class="nx">Router</span><span class="p">();</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4"></a>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="c1">// get all members</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/members&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`SELECT * FROM members `</span><span class="p">;</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8"></a>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">);</span>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">)</span>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16"></a><span class="p">});</span>
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17"></a>
</span><span id="__span-42-18"><a id="__codelineno-42-18" name="__codelineno-42-18"></a><span class="c1">// post one member</span>
</span><span id="__span-42-19"><a id="__codelineno-42-19" name="__codelineno-42-19"></a><span class="nx">router</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/members&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-20"><a id="__codelineno-42-20" name="__codelineno-42-20"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">firstname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstname</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstname</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-42-21"><a id="__codelineno-42-21" name="__codelineno-42-21"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lastname</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lastname</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-42-22"><a id="__codelineno-42-22" name="__codelineno-42-22"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-42-23"><a id="__codelineno-42-23" name="__codelineno-42-23"></a>
</span><span id="__span-42-24"><a id="__codelineno-42-24" name="__codelineno-42-24"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`INSERT INTO members(firstname, lastname, email) VALUES ($1, $2, $3) RETURNING *`</span><span class="p">;</span>
</span><span id="__span-42-25"><a id="__codelineno-42-25" name="__codelineno-42-25"></a>
</span><span id="__span-42-26"><a id="__codelineno-42-26" name="__codelineno-42-26"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-27"><a id="__codelineno-42-27" name="__codelineno-42-27"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">firstname</span><span class="p">,</span><span class="w"> </span><span class="nx">lastname</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="p">])</span>
</span><span id="__span-42-28"><a id="__codelineno-42-28" name="__codelineno-42-28"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
</span><span id="__span-42-29"><a id="__codelineno-42-29" name="__codelineno-42-29"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
</span><span id="__span-42-30"><a id="__codelineno-42-30" name="__codelineno-42-30"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-31"><a id="__codelineno-42-31" name="__codelineno-42-31"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">)</span>
</span><span id="__span-42-32"><a id="__codelineno-42-32" name="__codelineno-42-32"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-42-33"><a id="__codelineno-42-33" name="__codelineno-42-33"></a><span class="p">});</span>
</span><span id="__span-42-34"><a id="__codelineno-42-34" name="__codelineno-42-34"></a>
</span><span id="__span-42-35"><a id="__codelineno-42-35" name="__codelineno-42-35"></a><span class="c1">// get one member via id</span>
</span><span id="__span-42-36"><a id="__codelineno-42-36" name="__codelineno-42-36"></a><span class="nx">router</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/members/:id&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-37"><a id="__codelineno-42-37" name="__codelineno-42-37"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`SELECT * FROM members WHERE id=$1`</span><span class="p">;</span>
</span><span id="__span-42-38"><a id="__codelineno-42-38" name="__codelineno-42-38"></a>
</span><span id="__span-42-39"><a id="__codelineno-42-39" name="__codelineno-42-39"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-40"><a id="__codelineno-42-40" name="__codelineno-42-40"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-42-41"><a id="__codelineno-42-41" name="__codelineno-42-41"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">id</span><span class="p">])</span>
</span><span id="__span-42-42"><a id="__codelineno-42-42" name="__codelineno-42-42"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
</span><span id="__span-42-43"><a id="__codelineno-42-43" name="__codelineno-42-43"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rowCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
</span><span id="__span-42-44"><a id="__codelineno-42-44" name="__codelineno-42-44"></a><span class="w">            </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mf">0</span><span class="p">]);</span>
</span><span id="__span-42-45"><a id="__codelineno-42-45" name="__codelineno-42-45"></a><span class="w">        </span><span class="k">else</span>
</span><span id="__span-42-46"><a id="__codelineno-42-46" name="__codelineno-42-46"></a><span class="w">            </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;No member found with id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-42-47"><a id="__codelineno-42-47" name="__codelineno-42-47"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-48"><a id="__codelineno-42-48" name="__codelineno-42-48"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">)</span>
</span><span id="__span-42-49"><a id="__codelineno-42-49" name="__codelineno-42-49"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-42-50"><a id="__codelineno-42-50" name="__codelineno-42-50"></a><span class="p">});</span>
</span><span id="__span-42-51"><a id="__codelineno-42-51" name="__codelineno-42-51"></a>
</span><span id="__span-42-52"><a id="__codelineno-42-52" name="__codelineno-42-52"></a><span class="c1">// update one member</span>
</span><span id="__span-42-53"><a id="__codelineno-42-53" name="__codelineno-42-53"></a><span class="nx">router</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;/members/:id&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-54"><a id="__codelineno-42-54" name="__codelineno-42-54"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`SELECT * FROM members WHERE id=$1`</span><span class="p">;</span>
</span><span id="__span-42-55"><a id="__codelineno-42-55" name="__codelineno-42-55"></a>
</span><span id="__span-42-56"><a id="__codelineno-42-56" name="__codelineno-42-56"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-42-57"><a id="__codelineno-42-57" name="__codelineno-42-57"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">id</span><span class="p">])</span>
</span><span id="__span-42-58"><a id="__codelineno-42-58" name="__codelineno-42-58"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rowCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span>
</span><span id="__span-42-59"><a id="__codelineno-42-59" name="__codelineno-42-59"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-42-60"><a id="__codelineno-42-60" name="__codelineno-42-60"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">member</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">result</span><span class="p">.</span><span class="nx">rows</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
</span><span id="__span-42-61"><a id="__codelineno-42-61" name="__codelineno-42-61"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">firstname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstname</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstname</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">member</span><span class="p">.</span><span class="nx">firstname</span><span class="p">;</span>
</span><span id="__span-42-62"><a id="__codelineno-42-62" name="__codelineno-42-62"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">lastname</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lastname</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">lastname</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">member</span><span class="p">.</span><span class="nx">lastname</span><span class="p">;</span>
</span><span id="__span-42-63"><a id="__codelineno-42-63" name="__codelineno-42-63"></a><span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">email</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">member</span><span class="p">.</span><span class="nx">email</span><span class="p">;</span>
</span><span id="__span-42-64"><a id="__codelineno-42-64" name="__codelineno-42-64"></a>
</span><span id="__span-42-65"><a id="__codelineno-42-65" name="__codelineno-42-65"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">updatequery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`UPDATE members SET </span>
</span><span id="__span-42-66"><a id="__codelineno-42-66" name="__codelineno-42-66"></a><span class="sb">            firstname = $1, </span>
</span><span id="__span-42-67"><a id="__codelineno-42-67" name="__codelineno-42-67"></a><span class="sb">            lastname = $2,</span>
</span><span id="__span-42-68"><a id="__codelineno-42-68" name="__codelineno-42-68"></a><span class="sb">            email = $3</span>
</span><span id="__span-42-69"><a id="__codelineno-42-69" name="__codelineno-42-69"></a><span class="sb">            WHERE id=$4;`</span><span class="p">;</span>
</span><span id="__span-42-70"><a id="__codelineno-42-70" name="__codelineno-42-70"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">updateresult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">updatequery</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">firstname</span><span class="p">,</span><span class="w"> </span><span class="nx">lastname</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="p">,</span><span class="w"> </span><span class="nx">id</span><span class="p">]);</span>
</span><span id="__span-42-71"><a id="__codelineno-42-71" name="__codelineno-42-71"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">updateresult</span><span class="p">)</span>
</span><span id="__span-42-72"><a id="__codelineno-42-72" name="__codelineno-42-72"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span><span class="w"> </span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">firstname</span><span class="p">,</span><span class="w"> </span><span class="nx">lastname</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-42-73"><a id="__codelineno-42-73" name="__codelineno-42-73"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-74"><a id="__codelineno-42-74" name="__codelineno-42-74"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">)</span>
</span><span id="__span-42-75"><a id="__codelineno-42-75" name="__codelineno-42-75"></a><span class="w">        </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
</span><span id="__span-42-76"><a id="__codelineno-42-76" name="__codelineno-42-76"></a><span class="w">            </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Member with id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; does not exist!&quot;</span>
</span><span id="__span-42-77"><a id="__codelineno-42-77" name="__codelineno-42-77"></a><span class="w">        </span><span class="p">})</span>
</span><span id="__span-42-78"><a id="__codelineno-42-78" name="__codelineno-42-78"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-42-79"><a id="__codelineno-42-79" name="__codelineno-42-79"></a><span class="p">});</span>
</span><span id="__span-42-80"><a id="__codelineno-42-80" name="__codelineno-42-80"></a>
</span><span id="__span-42-81"><a id="__codelineno-42-81" name="__codelineno-42-81"></a>
</span><span id="__span-42-82"><a id="__codelineno-42-82" name="__codelineno-42-82"></a><span class="c1">// delete one member via id</span>
</span><span id="__span-42-83"><a id="__codelineno-42-83" name="__codelineno-42-83"></a><span class="nx">router</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="s1">&#39;/members/:id&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="w"> </span><span class="nx">res</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-84"><a id="__codelineno-42-84" name="__codelineno-42-84"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`DELETE FROM members WHERE id=$1`</span><span class="p">;</span>
</span><span id="__span-42-85"><a id="__codelineno-42-85" name="__codelineno-42-85"></a>
</span><span id="__span-42-86"><a id="__codelineno-42-86" name="__codelineno-42-86"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-87"><a id="__codelineno-42-87" name="__codelineno-42-87"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-42-88"><a id="__codelineno-42-88" name="__codelineno-42-88"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">client</span><span class="p">.</span><span class="nx">query</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="nx">id</span><span class="p">])</span>
</span><span id="__span-42-89"><a id="__codelineno-42-89" name="__codelineno-42-89"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span>
</span><span id="__span-42-90"><a id="__codelineno-42-90" name="__codelineno-42-90"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">rowCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span>
</span><span id="__span-42-91"><a id="__codelineno-42-91" name="__codelineno-42-91"></a><span class="w">            </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Member with id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot; deleted&quot;</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-42-92"><a id="__codelineno-42-92" name="__codelineno-42-92"></a><span class="w">        </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-93"><a id="__codelineno-42-93" name="__codelineno-42-93"></a><span class="w">            </span><span class="nx">res</span><span class="p">.</span><span class="nx">status</span><span class="p">(</span><span class="mf">404</span><span class="p">)</span>
</span><span id="__span-42-94"><a id="__codelineno-42-94" name="__codelineno-42-94"></a><span class="w">            </span><span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;No member found with id=&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-42-95"><a id="__codelineno-42-95" name="__codelineno-42-95"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-42-96"><a id="__codelineno-42-96" name="__codelineno-42-96"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-97"><a id="__codelineno-42-97" name="__codelineno-42-97"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">)</span>
</span><span id="__span-42-98"><a id="__codelineno-42-98" name="__codelineno-42-98"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-42-99"><a id="__codelineno-42-99" name="__codelineno-42-99"></a><span class="p">});</span>
</span><span id="__span-42-100"><a id="__codelineno-42-100" name="__codelineno-42-100"></a>
</span><span id="__span-42-101"><a id="__codelineno-42-101" name="__codelineno-42-101"></a>
</span><span id="__span-42-102"><a id="__codelineno-42-102" name="__codelineno-42-102"></a><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">router</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
</details>
<div class="admonition success">
<p class="admonition-title">Success</p>
<p>Wir haben nun auch ein Backend, das auf die PostgreSQL zugreift, die Sie auch in der Datenbankvorlesung verwenden. Sie benötigen also keine eigene Installation der PostgreSQL. Die Befüllung der Datenbank erfolgt per Skript. Wir haben eine erste eigene REST-API implementiert.  </p>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Fußzeile" >
        
          
          <a href="../backend/" class="md-footer__link md-footer__link--prev" aria-label="Zurück: Backend (MongoDB)">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Zurück
              </span>
              <div class="md-ellipsis">
                Backend (MongoDB)
              </div>
            </div>
          </a>
        
        
          
          <a href="../fe-be-anbindung/" class="md-footer__link md-footer__link--next" aria-label="Weiter: Front- &amp; Backend - Anbindung">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Weiter
              </span>
              <div class="md-ellipsis">
                Front- & Backend - Anbindung
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Jörn Freiheit
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["instant", "tabs", "content.code.copy", "navigation.footer"], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "In Zwischenablage kopiert", "clipboard.copy": "In Zwischenablage kopieren", "search.result.more.one": "1 weiteres Suchergebnis auf dieser Seite", "search.result.more.other": "# weitere Suchergebnisse auf dieser Seite", "search.result.none": "Keine Suchergebnisse", "search.result.one": "1 Suchergebnis", "search.result.other": "# Suchergebnisse", "search.result.placeholder": "Suchbegriff eingeben", "search.result.term.missing": "Es fehlt", "select.version": "Version ausw\u00e4hlen"}}</script>
    
    
      <script src="../assets/javascripts/bundle.60a45f97.min.js"></script>
      
    
  </body>
</html>